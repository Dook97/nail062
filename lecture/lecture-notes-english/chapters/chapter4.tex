\chapter{The Method of Analytic Tableaux}
\label{chapter:tableau-method-propositional}

%todo

In this chapter, we introduce the \emph{Method of Analytic Tableaux}. It is a syntactic procedure that we can use to determine whether a given statement is true in a given theory without having to deal with semantics (e.g., searching for all models, which is impractical). We will prove its \emph{correctness} ('it gives correct answers') and \emph{completeness} ('it always works'), and we will also use it to prove the so-called \emph{Compactness Theorem} ('properties of an infinite object can be shown for its finite parts').

\section{Formal Proof Systems}

A \emph{formal proof system} formalizes 'proof' (e.g., in mathematics) as a precisely (algorithmically) given syntactic procedure. A \emph{proof} of the fact that a statement $\varphi$ holds in a theory $T$ (i.e., $T \models \varphi$) is a finite syntactic object derived from the axioms of $T$ and the statement $\varphi$. If a proof exists, it can be found 'algorithmically',\footnote{Here we must be cautious in the case of an infinite theory $T$, how is it given? The algorithm must have effective access to all axioms.} and we are also able to algorithmically verify that the given object is indeed a proof.

If a proof exists, we say that $\varphi$ is (in the given proof system) \emph{provable} from $T$, and we write $T \proves \varphi$. We require two properties from a proof system:
\begin{itemize}
    \item \emph{correctness}: if a statement is provable from a theory, it is true in that theory ($T \proves \varphi \Rightarrow T \models \varphi$)
    \item \emph{completeness}: if a statement is true in a theory, it is provable from that theory ($T \models \varphi \Rightarrow T \proves \varphi$)
\end{itemize}
(Although correctness is always required, an effective proof system can be practical even if it is not complete, especially if it is complete for some interesting class of statements or theories.)

In this chapter, besides the \emph{tableaux method}, we will also introduce the \emph{Hilbert calculus}, and in the next chapter, we will present another proof system, the so-called \emph{resolution method}.

\section{Introduction to the Tableaux Method}

For the rest of this chapter, we will assume that we have a given \emph{countable} language $\mathbb{P}$. This implies that any theory over $\mathbb{P}$ is also countable. We will first focus on the case where $T = \emptyset$, i.e., we are proving that a statement $\varphi$ is \emph{logically} valid (it is a \emph{tautology}). 

A \emph{tableau} is a labeled tree representing the search for a counterexample, i.e., a model in which $\varphi$ does not hold. The labels on the nodes, which we will call \emph{entries}, consist of the symbol $\mathrm{T}$ or $\mathrm{F}$ ('True'/'False') followed by a statement $\psi$ and represent the assumption (requirement) that the statement $\psi$ holds or does not hold in a model, respectively. We place the entry $\mathrm{F}\varphi$ at the root of the tableau, i.e., we are looking for a model in which $\varphi$ \emph{does not hold}. We will then develop the tableau using rules for \emph{reducing} the entries. These rules ensure the following invariant:
\begin{quote}
    Any model that \emph{matches} the entry at the root (i.e., in which $\varphi$ does not hold) must \emph{match} some branch of the tableau (i.e., satisfy all the requirements expressed by the entries on that branch).
\end{quote}
If a branch contains entries of the form $\mathrm{T}\psi$ and $\mathrm{F}\psi$, we say that the branch \emph{fails} (is \emph{contradictory}) and we know that no model can match it. If all branches fail, we know that there is no model in which $\varphi$ does not hold, and thus we have a \emph{proof} that $\varphi$ holds. (Note that this is a \emph{proof by contradiction}.)

If a branch does not fail but is \emph{complete}, i.e., all entries are reduced, we know that $\varphi$ does not hold, and we will be able to construct a specific model from this branch in which it does not hold.

\begin{example}\label{example:tableau-intro-examples}
Let's illustrate the entire procedure with two examples, see Figure \ref{figure:tableau-proof-two-examples}.
\begin{itemize}
    \item[(a)] First, let's construct a tableau proof of the statement $\varphi = ((p \limplies q) \limplies p) \limplies p$. We start with the root entry $\mathrm{F}\varphi$. This entry is of the form $\mathrm{F}\varphi_1 \limplies \varphi_2$ ('implication does not hold'), so if any model matches it, it must satisfy $\mathrm{T}(p \limplies q) \limplies p$ and $\mathrm{F}p$. We thus add these two entries. (We actually add the \emph{atomic tableau} for this case, see Table \ref{table:atomic-tableaux}, but we omit the root of this atomic tableau to avoid repeating the same entry.) This reduces the entry at the root.
    
    We continue with the entry $\mathrm{T}(p \limplies q) \limplies p$, which is of the form 'implication holds', branching into two branches: the model either satisfies $\mathrm{F}(p \limplies q)$ or $\mathrm{T}p$. The right branch \emph{fails} (is \emph{contradictory}) because it contains the entries $\mathrm{T}p$ and $\mathrm{F}p$, so no model matches it; we mark it with the symbol~$\otimes$. In the left branch, we further reduce the entry $\mathrm{F}p \limplies q$ and also get a contradictory branch. All branches are contradictory, so no counterexample exists, and we have a proof of the statement $\varphi$. We write $\proves \varphi$.
    
    \item[(b)] Now let's construct a tableau with the entry $\mathrm{F}(\neg q \lor p) \limplies p$. We are trying to find a counterexample: a model in which $(\neg q \lor p) \limplies p$ does not hold. We first used the atomic tableau for 'implication does not hold' and then reduced the entry $\mathrm{T}\neg q \lor p$ by adding the atomic tableau for 'disjunction holds'. The right branch failed. In the left branch, we further reduced $\mathrm{T}\neg q$ to $\mathrm{F}q$ (the atomic tableau for 'negation holds'), obtaining a complete branch since all entries have been reduced. This complete branch is not contradictory (we mark it with the symbol $\checkmark$). This means that a counterexample exists: we have the entries $\mathrm{F}p$ and $\mathrm{F}q$, which correspond to the model $(0,0)$, where $(\neg q \lor p) \limplies p$ does not hold.

\end{itemize}

In the next section, we will formalize the entire procedure and explain what to do when we want to prove statements not in logic, but in some theory $T$ (spoiler alert: we add the entries $\mathrm{T}\alpha$ for the axioms $\alpha \in T$ during the construction). We will also show an example with an infinite theory where a \emph{complete} branch sometimes needs to be infinite.

In the rest of this section, however, we will first define all the \emph{atomic tableaux} needed for construction and formalize the concept of a \emph{tree}.

\begin{figure}
\begin{minipage}{.49\textwidth}
\centering
\begin{forest}
[$\mathrm{F}((p \limplies q) \limplies p) \limplies p$
    [$\mathrm{T}(p \limplies q) \limplies p$
        [$\mathrm{F}p$
            [$\mathrm{F}p \limplies q$
                [$\mathrm{T}p$ 
                    [$\mathrm{F}q$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                ]                
            ]
            [$\mathrm{T}p$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}
            ]
        ]
    ]
]
\end{forest}
\end{minipage}
\begin{minipage}{.49\textwidth}
\centering
\begin{forest}
[$\mathrm{F}(\neg q \lor p) \limplies p$
    [$\mathrm{T}\neg q \lor p$
        [$\mathrm{F}p$
            [$\mathrm{T}\neg q$
                [$\mathrm{F}q$, tikz={\node[fit to=tree,label=below:$\checkmark$] {};}]
            ]
            [$\mathrm{T}p$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}
            ]
        ]
    ]
]
\end{forest}
\end{minipage}
\label{figure:tableau-proof-two-examples}
\caption{Examples of tableaux. (a) Tableau proof of the statement $((p \limplies q) \limplies p) \limplies p$. (b) Tableau for the statement $(\neg q \lor p) \limplies p$. The left branch gives a counterexample, the model $(0,0)$ where the statement does not hold.}
\end{figure}
\end{example}


\subsection{Atomic Tableaux}
Atomic tableaux represent the rules by which we reduce the entries. For each logical connective and each of the two signs $\mathrm{T}$/ $\mathrm{F}$, we have one atomic tableau, shown in Table \ref{table:atomic-tableaux}.

\begin{table}[htbp]
\centering
\begin{tabular}{@{}c||c|c|c|c|c@{}}
 & $\neg$ & $\land$ & $\lor$ & $\limplies$ & $\liff$  \\ \midrule \midrule
True
&  
\begin{forest}
[$\mathrm{T}\neg\varphi$ [$\mathrm{F}\varphi$]]
\end{forest}
&  
\begin{forest}
[$\mathrm{T}\varphi\land\psi$ [$\mathrm{T}\varphi$ [$\mathrm{T}\psi$]]]
\end{forest}
& 
\begin{forest}
[$\mathrm{T}\varphi\lor\psi$ [$\mathrm{T}\varphi$] [$\mathrm{T}\psi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{T}\varphi\limplies\psi$ [$\mathrm{F}\varphi$] [$\mathrm{T}\psi$]]
\end{forest}
&  
\begin{forest}
[$\mathrm{T}\varphi\liff\psi$ [$\mathrm{T}\varphi$ [$\mathrm{T}\psi$]] [$\mathrm{F}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
\\ \midrule
False 
& 
\begin{forest}
[$\mathrm{F}\neg\varphi$ [$\mathrm{T}\varphi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\land\psi$ [$\mathrm{F}\varphi$] [$\mathrm{F}\psi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\lor\psi$ [$\mathrm{F}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\limplies\psi$ [$\mathrm{T}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\liff\psi$ [$\mathrm{T}\varphi$ [$\mathrm{F}\psi$]] [$\mathrm{F}\varphi$ [$\mathrm{T}\psi$]]]
\end{forest}
\end{tabular}
\caption{Atomic tableaux}
\label{table:atomic-tableaux}
\end{table}

The tableaux from Example \ref{example:tableau-intro-examples} are constructed by sequentially adding atomic tableaux, see Figure \ref{figure:tableau-proof-two-examples-construction}. The roots of the atomic tableaux are marked in blue; we will adopt the convention of not drawing them.

\begin{figure}
    \begin{minipage}{.49\textwidth}
    \centering
    \begin{forest}
    [$\mathrm{F}((p \limplies q) \limplies p) \limplies p$
        [\textcolor{blue}{$\mathrm{F}((p \limplies q) \limplies p) \limplies p$}, tikz={\node[fit=()(!1)(!ll),rectangle,draw=blue!20,minimum size=12pt] {};}
            [$\mathrm{T}(p \limplies q) \limplies p$
                [$\mathrm{F}p$
                    [\textcolor{blue}{$\mathrm{T}(p \limplies q) \limplies p$}, tikz={\node[fit=()(!1)(!l),rectangle,draw=blue!20,minimum size=12pt] {};}
                        [$\mathrm{F}p \limplies q$
                            [\textcolor{blue}{$\mathrm{F}p \limplies q$}, tikz={\node[fit=()(!1)(!ll),rectangle,draw=blue!20,minimum size=12pt] {};}
                                [$\mathrm{T}p$ 
                                    [$\mathrm{F}q$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                ]
                            ]
                        ]
                        [$\mathrm{T}p$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}
                        ]
                    ]
                ]
            ]
        ]
    ]
    \end{forest}
    \end{minipage}
    \begin{minipage}{.49\textwidth}
    \centering
    \begin{forest}
    [$\mathrm{F}(\neg q \lor p) \limplies p$
        [\textcolor{blue}{$\mathrm{F}(\neg q \lor p) \limplies p$}, tikz={\node[fit=()(!1)(!ll),rectangle,draw=blue!20,minimum size=12pt] {};}
            [$\mathrm{T}\neg q \lor p$
                [$\mathrm{F}p$
                    [\textcolor{blue}{$\mathrm{T}(\neg q \lor p)$}, tikz={\node[fit=()(!1)(!l),rectangle,draw=blue!20,minimum size=12pt] {};}
                        [$\mathrm{T}\neg q$
                            [\textcolor{blue}{$\mathrm{T}\neg q$}, tikz={\node[fit=()(!1)(!l),rectangle,draw=blue!20,minimum size=12pt] {};}
                                [$\mathrm{F}q$, tikz={\node[fit to=tree,label=below:$\checkmark$] {};}]
                            ]
                        ]
                        [$\mathrm{T}p$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}
                        ]
                    ]
                ]
            ]
        ]
    ]
    \end{forest}
    \end{minipage}
    \label{figure:tableau-proof-two-examples-construction}
    \caption{Construction of tableaux from Example \ref{example:tableau-intro-examples}.}
\end{figure}

\begin{exercise}\label{exercise:construct-tableaux}
    Try to construct a tableau with the entry $\mathrm{F}((\neg p \land \neg q) \lor p) \limplies (\neg p \land \neg q)$ at the root and also a tableau with the entry $\mathrm{T}(p \limplies q) \liff (p \land \neg q)$. When constructing, use only atomic tableaux (check if your construction matches the definition of a tableau from the following section). Think about what these tableaux say about the statements at their roots.
\end{exercise}

\begin{exercise}
Verify that all atomic tableaux satisfy the invariant: if a model matches the entry at the root, it matches some branch.
\end{exercise}

\begin{exercise}
Propose atomic tableaux for the logical connectives NAND, NOR, XOR, IFTE.
\end{exercise}

\subsection{On Trees}
Before we proceed to the formal definition and proofs, let's specify what we mean by the term tree. In graph theory, a tree would be called a connected graph without cycles, but our trees are rooted, ordered (i.e., with left-right order among the children of each node), and labeled. They can, and often will, be infinite. Formally:

\begin{definition}[Tree]
\begin{itemize}
\item A \emph{tree} is a non-empty set $T$ with a partial order $<_T$ that has a (single) minimal element (\emph{root}) and in which the set of ancestors of any node is \emph{well-ordered}.\footnote{That is, every non-empty subset has a least element. (This prevents infinite descending chains of ancestors.)}
\item A \emph{branch} of a tree $T$ is a maximal\footnote{That is, it cannot be extended by adding more nodes from the tree.} linearly ordered subset of $T$.
\item An \emph{ordered tree} is a tree $T$ along with a linear order $<_L$ on the set of children of each node. We call the order of children \emph{left-right} while the order $<_T$ is \emph{tree order}.
\item A \emph{labeled tree} is a tree along with a labeling function $\mathrm{label}\colon V(T) \to \mathrm{Labels}$.
\end{itemize}
\end{definition}

We will use standard terminology about trees, for example, we will talk about the \emph{$n$-th level of a tree} or the \emph{depth} of a tree (which is infinite if we have an infinite branch). In one of the theorems that we will prove below, we will need the following famous result, which is a consequence of the axiom of choice.

\begin{lemma}[König's Lemma]
An infinite, finitely branching tree has an infinite branch.
\end{lemma}
\noindent (A tree is \emph{finitely branching} if each node has finitely many children.)


\section{Tableau Proof}

We now present the formal definition of a tableau. We will also include the theory $T$ in the definition, whose axioms can be added during the construction with the sign $\mathrm{T}$ ("true"). Recall that an \emph{entry} is an expression $\mathrm{T}\varphi$ or $\mathrm{F}\varphi$, where $\varphi$ is some statement.

\begin{definition}[Tableau]
A \emph{finite tableau from the theory $T$} is an ordered, labeled tree constructed by applying finitely many of the following rules:
\begin{itemize}
    \item A single-node tree labeled with any entry is a tableau from the theory $T$.
    \item For any entry $P$ on any branch $V$, we can attach the atomic tableau for the entry $P$ at the end of the branch $V$.
    \item We can attach the entry $\mathrm{T}\alpha$ for any axiom $\alpha \in T$ at the end of any branch.
\end{itemize}
A \emph{tableau from the theory $T$} can be either finite or \emph{infinite}: in the latter case, it is constructed in countably many steps. Formally, it can be expressed as the union $\tau = \bigcup_{i \geq 0} \tau_i$, where $\tau_i$ are finite tableaux from $T$, $\tau_0$ is a single-node tableau, and $\tau_{i+1}$ is obtained from $\tau_i$ in one step.\footnote{We take the union because, in each step, we add new nodes to the tableau, so $\tau_i$ is a subtree of $\tau_{i+1}$.}

A tableau \emph{for the entry $P$} is a tableau that has the entry $P$ at its root.
\end{definition}

Recall the convention that we do not write the root of an atomic tableau (since the node with the entry $P$ is already in the tableau). The definition does not specify the order in which to perform the steps; however, later we will specify a concrete construction procedure (algorithm) that we will call the \emph{systematic tableau}.

To obtain a proof system, it remains to define the concept of a \emph{tableau proof} (and related terms). Recall once again that it is a proof by contradiction, i.e., we assume the statement does not hold and find a contradiction (a contradictory tableau):

\begin{definition}[Tableau Proof]
A \emph{tableau proof} of the statement $\varphi$ from the theory $T$ is a \emph{contradictory} tableau from the theory $T$ with the entry $\mathrm{F}\varphi$ at the root. If it exists, then $\varphi$ is \emph{(tableau) provable} from $T$, written as $T \proves \varphi$. (Also, define \emph{tableau refutation} as a contradictory tableau with the entry $\mathrm{T}\varphi$ at the root. If it exists, then $\varphi$ is \emph{(tableau) refutable} from $T$, i.e., $T \proves \neg \varphi$ holds.)
\begin{itemize}
    \item A tableau is \emph{contradictory} if every branch is contradictory.
    \item A branch is \emph{contradictory} if it contains entries $\mathrm{T}\psi$ and $\mathrm{F}\psi$ for some statement $\psi$; otherwise, it is \emph{non-contradictory}.
    \item A tableau is \emph{complete} if every branch is complete.
    \item A branch is \emph{complete} if 
    \begin{itemize}
        \item it is contradictory, or
        \item every entry on this branch is \emph{reduced} and it contains the entry $\mathrm{T}\alpha$ for every axiom $\alpha \in T$.
    \end{itemize}
     
    \item An entry $P$ is \emph{reduced} on the branch $V$ passing through this entry if 
    \begin{itemize}
        \item it is of the form $\mathrm{T}p$ or $\mathrm{F}p$ for some propositional variable $p \in \mathbb{P}$, or
        \item it appears on $V$ as the root of an atomic tableau\footnote{Although, by convention, we do not write this root.} (i.e., typically, during the construction of the tableau, it has already been developed on $V$).
    \end{itemize}
\end{itemize}
\end{definition}

\begin{example}\label{example:tableaux-from-theory}
    Let's illustrate two examples. The tableaux are shown in Figure \ref{figure:tableaux-from-theory-figure}. 
    \begin{itemize}
        \item[(a)] Tableau proof of the statement $\psi$ from the theory $T = \{\varphi, \varphi \limplies \psi\}$, i.e., $T \proves \psi$ (where $\varphi, \psi$ are some fixed statements). This fact is called the \emph{Deduction Theorem}.
        \item[(b)] Complete tableau for the statement $p_0$ from the theory $T = \{p_{n+1} \limplies p_n \mid n \in \mathbb{N}\}$. The leftmost branch is non-contradictory and complete. It contains the entries $\mathrm{T}p_{i+1} \limplies p_i$ and $\mathrm{F}p_i$ for all $i \in \mathbb{N}$. Thus, it matches the model $v = (0,0,\dots)$, i.e., $v: \mathbb{P} \to \{0,1\}$ where $v(p_i) = 0$ for all $i$.
    \end{itemize} 
\end{example}

\begin{figure}
    \begin{minipage}{.49\textwidth}
    \centering
    \begin{forest}
    [$\mathrm{F}\psi$
        [\textcolor{blue}{$\mathrm{T}\varphi \limplies \psi$}
            [$\mathrm{F}\varphi$
                [\textcolor{blue}{$\mathrm{T}\varphi$}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
            ]                
            [$\mathrm{T}\psi$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
        ]
    ]
    \end{forest}
    \end{minipage}
    \begin{minipage}{.49\textwidth}
    \centering
    \begin{forest}
    [$\mathrm{F}p_0$
        [\textcolor{blue}{$\mathrm{T}p_1 \limplies p_0$}
            [$\mathrm{F}p_1$
                [\textcolor{blue}{$\mathrm{T}p_2 \limplies p_1$}
                    [$\mathrm{F}p_2$ [$\vdots$]] 
                    [$\mathrm{T}p_0$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]                    
                ]                
            ]
            [$\mathrm{T}p_0$, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
        ]
    ]
    \end{forest}
    \end{minipage}
    \label{figure:tableaux-from-theory-figure}
    \caption{Tableaux from Example \ref{example:tableaux-from-theory}. Entries derived from axioms are marked in blue.}
\end{figure}

\begin{exercise}
    Let's return to the tableaux from Exercise \ref{exercise:construct-tableaux}. Are they tableau proofs or refutations (from the theory $T = \emptyset$)? Which entries on which branches are reduced? Which branches are contradictory, and which are complete?
\end{exercise}

\section{Finiteness and Systematicity of Proofs}\label{section:finiteness-and-systematicity-of-proofs}

In this section, we will prove that if a tableau proof exists, there is always also a \emph{finite} tableau proof. We will also present an algorithm by which a tableau proof can always be found; however, we will need the Theorems of Correctness and Completeness from the next section to prove this fact. For now, we will show that this algorithm will always allow us to construct a complete tableau.

Note that when reducing an entry, we only add entries containing shorter statements to the tableau. Therefore, if we have a finite theory and do not make unnecessary steps (e.g., repeatedly adding the same axiom or the same atomic tableau), it is easy to construct a complete tableau that will be finite.

If the theory $T$ is infinite, we must be more careful. We could construct the tableau indefinitely without ever reducing a particular entry or using any of the axioms. Therefore, we define a specific algorithm for constructing a tableau, and the resulting tableau will be called a \emph{systematic tableau}. The idea of the construction is simple: we alternate between reducing an entry (simultaneously on all non-contradictory branches passing through it) and using an axiom. We traverse the entries by levels, and within a level in left-right order. We traverse the axioms of the theory in the chosen numbering.

\begin{definition}
Let $R$ be an entry and (a finite or infinite\footnote{Recall that $T$ is countable since the language is (in the entire chapter) countable.}) theory $T = \{\alpha_1, \alpha_2, \dots\}$. A \emph{systematic tableau} from the theory $T$ for the entry $R$ is a tableau $\tau = \bigcup_{i \geq 0} \tau_i$, where $\tau_0$ is a single-node tableau with the entry $R$, and for each $i \geq 0$:

\begin{itemize}
    \item Let $P$ be the leftmost entry at the smallest level that is not reduced on any non-contradictory branch passing through $P$. We first define the tableau $\tau_i'$ as the tableau obtained from $\tau_i$ by attaching the atomic tableau for $P$ to each non-contradictory branch passing through $P$. (If such an entry does not exist, then $\tau_i' = \tau_i$.)
    \item Subsequently, $\tau_{i+1}$ is the tableau obtained from $\tau_i'$ by attaching $\mathrm{T}\alpha_{i+1}$ to each non-contradictory branch of $\tau_i'$. If $i < |T|$, otherwise (if $T$ is finite and we have already used all the axioms) skip this step and define $\tau_{i+1} = \tau_i'$.
\end{itemize}    
\end{definition}

\begin{lemma}\label{lemma:systematic-is-finished}
    A systematic tableau is complete.
\end{lemma}
\begin{proof}
    We will show that each branch is complete. Contradictory branches are complete. Non-contradictory branches contain entries $\mathrm{T}\alpha_i$ (which we added in the $i$-th step), and every entry on them is reduced. Indeed, if $P$ were not reduced on a non-contradictory branch $V$, it would be addressed in some step since there are only finitely many entries above $P$ and to the left of $P$. (We use the obvious fact that any prefix of a non-contradictory branch is also a non-contradictory branch, so during the construction, $V$ is never contradictory.)
\end{proof}

Now, let's return to the question of the finiteness of proofs:

\begin{theorem}[Finiteness of Contradiction]\label{theorem:finiteness-of-contradiction}
    If $\tau = \bigcup_{i \geq 0} \tau_i$ is a contradictory tableau, then there exists $n \in \mathbb{N}$ such that $\tau_n$ is a finite contradictory tableau.
\end{theorem}
\begin{proof}
    Consider the set $S$ of all nodes of the tree $\tau$ that do not contain a contradiction above them (in the tree order), i.e., a pair of entries $\mathrm{T}\psi$, $\mathrm{F}\psi$.

    If the set $S$ were infinite, by König's lemma applied to the subtree $\tau$ on the set $S$, we would have an infinite, non-contradictory branch in $S$. However, this would mean that we have a non-contradictory branch in $\tau$, which contradicts the fact that $\tau$ is contradictory. (In detail: The branch on $S$ would be a sub-branch of some branch $V$ in $\tau$, which is contradictory, i.e., it contains some (specific) contradictory pair of entries, which exists already in some finite prefix of $V$.)

    Therefore, the set $S$ is finite. This means that there exists $d \in \mathbb{N}$ such that the entire $S$ lies at a depth of at most $d$. Thus, every node at level $d+1$ has a contradiction above it. Choose $n$ such that $\tau_n$ already contains all the nodes of $\tau$ from the first $d+1$ levels: each branch of $\tau_n$ is therefore contradictory.
\end{proof}

\begin{corollary}\label{corollary:systematic-contradictory-is-finite}
    If we never extend contradictory branches during the construction of the tableau, e.g., for a systematic tableau, then a contradictory tableau is finite.
\end{corollary}
\begin{proof}
We use Theorem \ref{theorem:finiteness-of-contradiction}, and we have $\tau = \tau_n$ since we do not extend a contradictory tableau.    
\end{proof}

\begin{corollary}[Finiteness of Proofs]\label{corollary:finiteness-of-proofs}
    If $T \proves \varphi$, then there exists a \emph{finite} tableau proof of $\varphi$ from $T$.
\end{corollary}
\begin{proof}
It easily follows from Corollary \ref{corollary:systematic-contradictory-is-finite}: during the construction of $\tau$, we ignore steps that would extend a contradictory branch.
\end{proof}

We also state the following consequence. We will prove it in the next section.

\begin{corollary}[Systematicity of Proofs]\label{corollary:systematicity-of-proofs}
    If $T \proves \varphi$, then the systematic tableau is a (finite) tableau proof of $\varphi$ from $T$.
\end{corollary}

To prove this, we will need two facts: if $\varphi$ is provable from $T$, then it holds in $T$ (Correctness Theorem), i.e., no counterexample can exist. And if the systematic tableau had a non-contradictory branch, it would mean that a counterexample exists (which is the key to the Completeness Theorem).


\section{Correctness and Completeness}

In this section, we will prove that the tableau method is a \emph{correct} and \emph{complete} proof system, i.e., that $T \proves \varphi$ holds if and only if $T \models \varphi$.

\subsection{Correctness Theorem}

We say that a model $v$ \emph{agrees} with an entry $P$ if $P = \mathrm{T}\varphi$ and $v \models \varphi$, or $P = \mathrm{F}\varphi$ and $v \not\models \varphi$. Furthermore, $v$ agrees with a branch $V$ if it agrees with every entry on that branch.

As mentioned, the design of atomic tableaux ensures that if a model agrees with the entry at the root of the tableau, it agrees with some branch. It is not difficult to show the following lemma by induction on the construction of the tableau:
\begin{lemma}\label{lemma:agrees-with-branch}
    If a model of the theory $T$ agrees with the entry at the root of a tableau from theory $T$, then it agrees with some branch.
\end{lemma}
\begin{proof}
    Consider a tableau $\tau = \bigcup_{i \geq 0} \tau_i$ from theory $T$ and a model $v \in \M(T)$ that agrees with the root of $\tau$, i.e., with the (single-element) branch $V_0$ in the (single-element) $\tau_0$.
    
    By induction on $i$ (on the steps in the construction of the tableau), we find a sequence $V_0 \subseteq V_1 \subseteq \dots$ such that $V_i$ is a branch in the tableau $\tau_i$ agreeing with the model $v$, and $V_{i+1}$ extends $V_i$. The required branch of the tableau $\tau$ is then $V = \bigcup_{i \geq 0} V_i$.
    
    \begin{itemize}
        \item If $\tau_{i+1}$ is obtained from $\tau_i$ without extending the branch $V_i$, we define $V_{i+1} = V_i$.
        \item If $\tau_{i+1}$ is obtained from $\tau_i$ by adding the entry $\mathrm{T}\alpha$ (for some axiom $\alpha \in T$) to the end of the branch $V_i$, we define $V_{i+1}$ as this extended branch. Since $v$ is a model of $T$, it satisfies the axiom $\alpha$, so it agrees with the new entry $\mathrm{T}\alpha$.
        \item Let $\tau_{i+1}$ be obtained from $\tau_i$ by adding the atomic tableau for some entry $P$ to the end of the branch $V_i$. Since the model $v$ agrees with the entry $P$ (which is on the branch $V_i$), it agrees with the root of the added atomic tableau and thus with some branch of the atomic tableau. (This property is easily verified for all atomic tableaux.) We define $V_{i+1}$ as the extension of $V_i$ by this branch of the atomic tableau.\footnote{Or by any such branch: the model $v$ may agree with multiple branches of the atomic tableau.}
    \end{itemize}
\end{proof}

We can now prove the Correctness Theorem. In short, if a proof and a counterexample exist simultaneously, the counterexample would have to agree with some branch of the proof, but all branches are contradictory.

\begin{theorem}[Correctness]
If the statement $\varphi$ is tableau provable from the theory $T$, then $\varphi$ is true in $T$, i.e., $T \proves \varphi \Rightarrow T \models \varphi$.    
\end{theorem}

\begin{proof}
We will prove by contradiction. Assume that $\varphi$ is not true in $T$, i.e., there is a counterexample: a model $v \in \M(T)$ in which $\varphi$ does not hold.

Since $\varphi$ is provable from $T$, there exists a tableau proof of $\varphi$ from $T$, which is a contradictory tableau from $T$ with the entry $\mathrm{F}\varphi$ at the root. The model $v$ agrees with the entry $\mathrm{F}\varphi$, so by Lemma \ref{lemma:agrees-with-branch}, it agrees with some branch $V$. However, all branches are contradictory, including $V$. Therefore, $V$ contains the entries $\mathrm{T}\psi$ and $\mathrm{F}\psi$ (for some statement $\psi$), and the model $v$ agrees with these entries. Thus, we have $v \models \psi$ and simultaneously $v \not\models \psi$, which is a contradiction.
\end{proof}

\subsection{Completeness Theorem}

We will show that if the proof fails, i.e., if we obtain a \emph{non-contradictory} branch in a \emph{complete} tableau from theory $T$ for the entry $\mathrm{F}\varphi$, then this branch provides a counterexample: a model of the theory $T$ that agrees with the entry $\mathrm{F}\varphi$ at the root of the tableau, i.e., $\varphi$ does not hold in it. There may be multiple such models; we will define a specific one:

\begin{definition}[Canonical Model]\label{definition:canonical-model}
If $V$ is a non-contradictory branch of a complete tableau, then the \emph{canonical model} for $V$ is a model defined by the rule (for $p \in \mathbb{P}$):
$$
v(p)=\begin{cases}
    1 \text{ if the entry $\mathrm{T}p$ appears on $V$,}\\
    0 \text{ otherwise.}
\end{cases}
$$  
\end{definition}
\begin{lemma}\label{lemma:canonical-model-agrees}
    The canonical model for a (non-contradictory complete) branch $V$ agrees with $V$.
\end{lemma}
\begin{proof}
We will show that the canonical model $v$ agrees with all entries $P$ on the branch $V$ by induction on the structure of the statement in the entry.\footnote{Recall that this means induction on the depth of the statement tree.} First, the base case of the induction:
\begin{itemize}
    \item If $P = \mathrm{T}p$ for some atomic statement $p \in \mathbb{P}$, we have $v(p) = 1$ by definition; $v$ agrees with $P$.
    \item If $P = \mathrm{F}p$, then the entry $\mathrm{T}p$ cannot appear on the branch $V$, otherwise $V$ would be contradictory. By definition, we have $v(p) = 0$, and $v$ again agrees with $P$.
\end{itemize}
Now, the induction step. We will cover two cases; the others are proved similarly.
\begin{itemize}
    \item Let $P = \mathrm{T}\varphi \land \psi$. Since $V$ is a complete branch, the entry $P$ is reduced on it. This means that the entries $\mathrm{T}\varphi$ and $\mathrm{T}\psi$ appear on $V$. By the induction hypothesis, the model $v$ agrees with these entries, so $v \models \varphi$ and $v \models \psi$. Thus, $v \models \varphi \land \psi$ holds, and $v$ agrees with $P$.
    \item Let $P = \mathrm{F}\varphi \land \psi$. Since $P$ is reduced on $V$, the entry $\mathrm{F}\varphi$ or the entry $\mathrm{F}\psi$ appears on $V$. Therefore, $v \not\models \varphi$ or $v \not\models \psi$, from which it follows that $v \not\models \varphi \land \psi$, and $v$ agrees with $P$.
\end{itemize}
\end{proof}

\begin{theorem}[Completeness]
    If the statement $\varphi$ is true in theory $T$, then it is tableau provable from $T$, i.e., $T \models \varphi \Rightarrow T \proves \varphi$.    
\end{theorem}

\begin{proof}
We will show that any \emph{complete} (thus, for example, \emph{systematic}) tableau from $T$ with the entry $\mathrm{F}\varphi$ at the root must be contradictory. We will prove by contradiction: if such a tableau were not contradictory, it would contain a non-contradictory (complete) branch $V$. Consider the canonical model $v$ for this branch. Since $V$ is complete, it contains the entry $\mathrm{T}\alpha$ for all axioms $\alpha \in T$. By Lemma \ref{lemma:canonical-model-agrees}, the model $v$ agrees with all entries on $V$, thus satisfying all the axioms and we have $v \models T$. However, since $v$ also agrees with the entry $\mathrm{F}\varphi$ at the root, we have $v \not\models \varphi$, which means $T \not\models \varphi$, a contradiction. Thus, the tableau must have been contradictory, i.e., a tableau proof of $\varphi$ from $T$.
\end{proof}

\begin{proof}[Proof of Corollary \ref{corollary:systematicity-of-proofs}]
From the previous proof, we also obtain the `systematicity of proofs,' i.e., that a proof can always be found by constructing a systematic tableau: If $T \models \varphi$, then the systematic tableau for the entry $\mathrm{F}\varphi$ must be contradictory, and thus it is a tableau proof of $\varphi$ from $T$.
\end{proof}

\begin{exercise}
    Verify the remaining cases in the proof of Lemma \ref{lemma:canonical-model-agrees}.
\end{exercise}

\begin{exercise}
    Describe what \emph{all} models agreeing with a given non-contradictory complete branch look like.
\end{exercise}

\begin{exercise}
    Suggest a method to use the tableau method to find all models of a given theory $T$.
\end{exercise}

\section{Consequences of Correctness and Completeness}

The Correctness and Completeness Theorems together state that \emph{provability} is the same as \emph{truth}. This allows us to formulate syntactic analogs of semantic concepts and properties.

The analog of \emph{consequences} are \emph{theorems} of the theory $T$:
$$
\Thm_\mathbb{P}(T) = \{\varphi \in \VF_\mathbb{P} \mid T \proves \varphi\}
$$

\begin{corollary}[Provability = Truth]\label{corollary:corollary-of-soundness-and-completeness}
    For any theory $T$ and statements $\varphi, \psi$, the following hold:
    \begin{itemize}
        \item $T \proves \varphi$ if and only if $T \models \varphi$
        \item $\Thm_\mathbb{P}(T) = \Conseq_\mathbb{P}(T)$
    \end{itemize}
\end{corollary}
\begin{proof}
    This immediately follows from the Correctness Theorem and the Completeness Theorem.
\end{proof}

In all definitions and theorems, we can therefore replace the concept of `\emph{truth}' with the concept of `\emph{provability}' (i.e., the symbol `$\models$' with the symbol `$\proves$') and the concept of `\emph{consequence}' with the concept of `\emph{theorem}'. For example:
\begin{itemize}
    \item A theory is \emph{contradictory} if it proves a contradiction (i.e., $T \proves \bot$).
    \item A theory is \emph{complete} if for every statement $\varphi$, either $T \proves \varphi$ or $T \proves \neg \varphi$ (but not both, otherwise it would be contradictory).
\end{itemize}

Let us state one more easy consequence:

\begin{theorem}[Deduction Theorem]
For a theory $T$ and statements $\varphi, \psi$, we have:
$T, \varphi \proves \psi$ if and only if $T \proves \varphi \to \psi$.
\end{theorem}
\begin{proof}
    It suffices to prove that $T, \varphi \models \psi \Leftrightarrow T \models \varphi \to \psi$, which is straightforward.
\end{proof}

\begin{exercise}
Prove the Deduction Theorem directly using the transformation of tableau proofs.
\end{exercise}

\section{Compactness Theorem}

An important consequence of the Correctness and Completeness Theorems is the so-called \emph{Compactness Theorem}.\footnote{The word \emph{compactness} comes from compact (i.e., bounded and closed) sets in Euclidean spaces, where one can select a convergent subsequence from every sequence. You can imagine a sequence of increasing finite parts `converging' to the infinite whole.} This principle allows converting statements about infinite objects/processes into statements about (all) their finite parts.

\begin{theorem}[Compactness Theorem]\label{theorem:compactness-theorem}
A theory has a model if and only if every finite part of it has a model.    
\end{theorem}

\begin{proof}
Every model of a theory $T$ is evidently a model of each of its parts. We will prove the other implication by contradiction: Assume that $T$ has no model, i.e., it is contradictory, and find a finite part $T' \subseteq T$ that is also contradictory.

Since $T$ is contradictory, we have $T \proves \bot$ (here we need the Completeness Theorem). According to Corollary \ref{corollary:finiteness-of-proofs}, there exists a \emph{finite} tableau proof $\tau$ of the contradiction from $T$. The construction of this proof involves only finitely many steps, so we used only finitely many axioms from $T$. If we define $T' = \{\alpha \in T \mid \mathrm{T}\alpha \text{ is an entry in the tableau $\tau$}\}$, then $\tau$ is also a tableau proof of the contradiction from the theory $T'$. Therefore, $T'$ is a finite contradictory part of $T$.
\end{proof}

\subsection{Applications of Compactness}

The following simple application of the Compactness Theorem can be seen as a template followed by many other, more complex applications of this theorem. 

\begin{corollary}\label{corollary:infinite-bipartite-compactness}
A countably infinite graph is bipartite if and only if every finite subgraph of it is bipartite.    
\end{corollary}

\begin{proof}
    Every subgraph of a bipartite graph is evidently also bipartite. We will prove the other implication. A graph is bipartite if and only if it is 2-colorable. Let the colors be 0 and 1.

    We will construct a propositional theory $T$ in the language $\mathbb{P} = \{p_v \mid v \in V(G)\}$, where the value of the propositional variable $p_v$ represents the color of the vertex $v$.
    $$  
        T = \{p_u \liff \neg p_v \mid \{u, v\} \in E(G)\}
    $$
    Clearly, $G$ is bipartite if and only if $T$ has a model. According to the Compactness Theorem, it suffices to show that every finite part of $T$ has a model. Consider a finite $T' \subseteq T$. Let $G'$ be the subgraph of $G$ induced by the set of vertices mentioned in the theory $T'$, i.e., $V(G') = \{v \in V(G) \mid p_v \in \Var(T')\}$. Since $T'$ is finite, $G'$ is also finite, and by assumption, it is 2-colorable. Any 2-coloring of $V(G')$ determines a model of the theory $T'$.
\end{proof}

The essence of this technique is to describe the desired property of an infinite object using an (infinite) propositional theory. Additionally, note how we construct a finite subobject having the given property from a finite part of the theory (in our case, a finite subgraph that is bipartite).

\begin{exercise}
    Generalize Corollary \ref{corollary:infinite-bipartite-compactness} for more colors, i.e., show that a countably infinite graph is $k$-colorable if and only if every finite subgraph of it is $k$-colorable. (See Section \ref{subsection:example-graph-coloring}.)
\end{exercise}

\begin{exercise}
    Show that every partial order on a countable set can be extended to a linear order.
\end{exercise}

\begin{exercise}
    State and prove the `countably infinite' analog of Hall's theorem.
\end{exercise}

\section{Hilbert Calculus}\label{section:hilbert-calculus-propositional}

At the end of the chapter on the tableau method, we will show another proof system for comparison, the so-called \emph{Hilbert deductive system} or \emph{Hilbert calculus}. This is the oldest proof system, modeled after mathematical proofs. As we will see from the example, proving in it is quite laborious, so it is more suitable for theoretical purposes. It is also a correct and complete proof system. (We will show correctness, but leave completeness without proof.)

The Hilbert calculus uses only two basic logical connectives: negation and implication. (Recall that other logical connectives can be derived from these.) The system consists of logical axioms given by the following \emph{schemes} and a single \emph{derivation rule}, the so-called \emph{modus ponens}: 

\begin{definition}[Axiom Schemes in Hilbert Calculus]
For any statements $\varphi, \psi, \chi$, the following statements are logical axioms:
\begin{enumerate}[(i)]
    \item $\varphi \limplies (\psi \limplies \varphi)$
    \item $(\varphi \limplies (\psi \limplies \chi)) \limplies ((\varphi \limplies \psi) \limplies (\varphi \limplies \chi))$
    \item $(\neg \varphi \limplies \neg \psi) \limplies (\psi \limplies \varphi)$
\end{enumerate}        
\end{definition}

Note that all logical axioms are indeed tautologies. It should be noted that other systems of logical axioms can be chosen; there are many, see the article \href{https://en.wikipedia.org/wiki/List_of_Hilbert_systems}{List of Hilbert systems} on Wikipedia.

\begin{definition}[Modus Ponens]
The \emph{modus ponens} derivation rule states that if we have already proved the statement $\varphi$ and also the statement $\varphi \limplies \psi$, we can derive the statement $\psi$. We write it as follows:
$$
\frac{\varphi, \varphi \limplies \psi}{\psi}
$$ 
\end{definition}

Note that modus ponens is \emph{correct}, i.e., if $T \models \varphi$ and $T \models \varphi \limplies \psi$ hold in some theory, we also have $T \models \psi$.

We are now ready to define a \emph{proof}. It will be a finite sequence of statements, in which each newly written statement is either an axiom (logical or from the theory in which we are proving), or can be derived from the previous ones using modus ponens:

\begin{definition}[Hilbert Proof]
    A \emph{Hilbert proof} of a statement $\varphi$ from theory $T$ is a \emph{finite} sequence of statements $\varphi_0, \dots, \varphi_n = \varphi$, in which for each $i \leq n$, the following holds:
    \begin{itemize}
    \item $\varphi_i$ is a logical axiom, or
    \item $\varphi_i$ is an axiom of the theory ($\varphi_i \in T$), or
    \item $\varphi_i$ can be derived from some previous statements $\varphi_j, \varphi_k$ (where $j, k < i$) using modus ponens.
    \end{itemize}
    If a Hilbert proof exists, we say that $\varphi$ is \emph{(Hilbert) provable}, and we write $T \proves_H \varphi$.           
\end{definition}

We will illustrate the concept of a Hilbert proof with a simple example:

\begin{example}
Let us show that for the theory $T = \{\neg \varphi\}$ and for any statement $\psi$, we have $T \proves_H \varphi \limplies \psi$. The Hilbert proof is the following sequence of statements:
\begin{enumerate}\it
    \item $\neg \varphi$ \hfill axiom of the theory
    \item $\neg \varphi \limplies (\neg \psi \limplies \neg \varphi)$ \hfill logical axiom by (i)
    \item $\neg \psi \limplies \neg \varphi$ \hfill modus ponens on 1 and 2
    \item $(\neg \psi \limplies \neg \varphi) \limplies (\varphi \limplies \psi)$ \hfill logical axiom by (iii)
    \item $\varphi \limplies \psi$ \hfill modus ponens on 3 and 4 
\end{enumerate}
\end{example}

As mentioned earlier, the Hilbert calculus is a correct and complete proof system.

\begin{theorem}[Correctness of Hilbert Calculus]
For any theory $T$ and statement $\varphi$, we have: 
$$
T \proves_H \varphi \Rightarrow T \models \varphi
$$ 
\end{theorem}
\begin{proof}
By induction on the index $i$, we will show that every statement $\varphi_i$ in the proof (thus also $\varphi_n = \varphi$) holds in $T$.

If $\varphi_i$ is a logical axiom, $T \models \varphi_i$ holds because logical axioms are tautologies. If $\varphi_i \in T$, then clearly $T \models \varphi_i$ also holds. If $\varphi_i$ is obtained using modus ponens from $\varphi_j$ and $\varphi_k = \varphi_j \limplies \varphi_i$ (for some $j, k < i$), we know from the induction hypothesis that $T \models \varphi_j$ and $T \models \varphi_j \limplies \varphi_i$. Then, by the correctness of modus ponens, $T \models \varphi_i$ also holds.
\end{proof}

For completeness, we will state the completeness theorem but leave it without proof.

\begin{theorem}[Completeness of Hilbert Calculus]
For any theory $T$ and statement $\varphi$, we have: 
$$
T \models \varphi \Rightarrow T \proves_H \varphi
$$
\end{theorem}
