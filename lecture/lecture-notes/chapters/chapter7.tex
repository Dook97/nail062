\chapter{Tablo metoda v predikátové logice}

V této kapitole ukážeme, jak lze zobecnit \emph{metodu analytického tabla} z výrokové na predikátovou logiku.\footnote{Na tomto místě je dobré připomenout si tablo metodu ve výrokové logice, viz Kapitola \ref{chapter:tableau-method-propositional}.} Metoda funguje velmi podobně, musíme si ale poradit \emph{kvantifikátory}.

\section{Neformální úvod}

V této sekci tablo metodu neformálně představíme. K formálním definicím se vrátíme později. Začneme dvěma příklady, na kterých ilustruje, jak tablo metoda v predikátové logice funguje, a jak se vypořádá s kvantifikátory.

\begin{example} Na Obrázku \ref{figure:predicate-tableau-examples} jsou znázorněna dvě tabla. Jsou to tablo důkazy (v logice, tj. z prázdné teorie) \emph{sentencí} $(\exists x)\neg P(x)\limplies\neg(\forall x)P(x)$ (vpravo) a $\neg(\forall x)P(x)\limplies(\exists x)\neg P(x)$ (vlevo) jazyka $L=\langle P\rangle$ (bez rovnosti), kde $P$ je unární relační symbol. Symbol $c_0$ je \emph{pomocný konstantní symbol}, který do jazyka při konstrukci tabla přidáváme.

\begin{figure}[htbp]
\begin{minipage}{.49\textwidth}
\centering
\begin{forest}
    for tree={math content}
    [\F(\exists x)\neg P(x)\limplies\neg(\forall x)P(x)
        [\textcolor{red}{\T(\exists x)\neg P(x)}
            [\F\neg(\forall x)P(x)
                [\textcolor{blue}{\T(\forall x)P(x)}
                    [\T\neg P(c_0)
                        [\F P(c_0)
                            [\textcolor{blue}{\T(\forall x)P(x)}
                                [\T P(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                    ]                
                ]
            ]
        ]
    ]
\end{forest}
\end{minipage}
\begin{minipage}{.49\textwidth}
\centering
\begin{forest}
    for tree={math content}
    [\F\neg(\forall x)P(x)\limplies(\exists x)\neg P(x)
        [\T\neg(\forall x) P(x)
            [\textcolor{blue}{\F(\exists x)\neg P(x)}
                [\textcolor{red}{\F(\forall x)P(x)}
                    [\F P(c_0)
                        [\textcolor{blue}{\F (\exists x)\neg P(x)}
                            [\F\neg P(c_0)
                                [\T P(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                    ]                
                ]
            ]
        ]
    ]
\end{forest}
\end{minipage}
\label{figure:predicate-tableau-examples}
\caption{Příklady tabel. Položky typu `svědek' jsou znázorněny červeně, položky typu `všichni' modře.}
\end{figure}
\end{example}


\subsubsection{Položky}
Formule v položkách musí být vždy \emph{sentence}, neboť potřebujeme, aby měly v daném modelu \emph{pravdivostní hodnotu} (nezávisle na ohodnocení proměnných). To ale není zásadní omezení, chceme-li dokázat, že formule $\varphi$ platí v teorii $T$, můžeme nejprve nahradit formuli $\varphi$ a všechny axiomy $T$ jejich \emph{generálními uzávěry} (tj. univerzálně kvantifikujeme všechny volné proměnné). Získáme tak \emph{uzavřenou} teorii $T'$ a sentenci $\varphi'$ a platí: $T'\models\varphi'$ právě když $T\models\varphi$.

\subsubsection{Kvantifikátory}
Redukce položek funguje stejně, použijeme tatáž atomická tabla pro logické spojky (viz Tabulka \ref{table:atomic-tableaux}, kde místo výroků jsou $\varphi,\psi$ sentence). Musíme ale přidat 4 nová atomická tabla pro $\mathrm T/\mathrm F$ a univerzální/existenční kvantifikátor. Tyto položky dělíme na dva typy:
\begin{itemize}
    \item typ ``\emph{svědek}'': položky tvaru $\mathrm{T}(\exists x)\varphi(x)$ a $\mathrm{F}(\forall x)\varphi(x)$
    \item typ ``\emph{všichni}'': položky tvaru $\mathrm{T}(\forall x)\varphi(x)$ a $\mathrm{F}(\exists x)\varphi(x)$    
\end{itemize}
Příklady vidíme v tablech na Obrázku \ref{figure:predicate-tableau-examples} (`svědci' jsou červeně, `všichni' modře).

Kvantifikátor nemůžeme pouze odstranit, neboť výsledná formule $\varphi(x)$ by nebyla sentencí. Místo toho současně s odstraněním kvantifikátoru \emph{substituujeme} za $x$ nějaký \emph{konstantní term}, v nové položce tedy bude \emph{sentence} $\varphi(x/t)$. Jaký konstantní term $t$ substituujeme záleží na tom, zda jde o položku typu ``svědek'' nebo ``všichni''. 

\subsubsection{Pomocné konstantní symboly}
Jazyk $L$ teorie $T$, ve které dokazujeme, rozšíříme o spočetně mnoho \emph{nových (pomocných) konstantních symbolů} $C=\{c_0,c_1,c_2,\dots\}$ (ale budeme psát i $c,d,\dots$), výsledný rozšířený jazyk označíme $L_C$. Konstantní termy v jazyce $L_C$ tedy existují, i pokud původní jazyk $L$ nemá žádné konstanty. A vždy při konstrukci tabla máme k dispozici nějaký \emph{nový}, dosud \emph{nepoužitý} (ani v teorii, ani v konstruovaném tablu) pomocný konstantní symbol $c\in C$.

\subsubsection{Svědci}
Při redukci položky typu ``svědek'' substituujeme za proměnnou jeden z těchto nových, pomocných symbolů, a to takový, který \emph{dosud nebyl na dané větvi použit}. V případě položky $\T(\exists x)\varphi(x)$ tedy máme $\T\varphi(x/c)$. Tento konstantní symbol $c$ bude hrát roli (nějakého) prvku, který danou formuli splňuje (resp. vyvrací, jde-li o položku tvaru $\F(\forall x)\varphi(x)$). Zde používáme větu o konstantách (Věta \ref{theorem:on-constants}). Je důležité, že symbol $c$ dosud nebyl na větvi ani v teorii nijak použit. Typicky ale poté použijeme položky typu ``všichni'', abychom se dozvěděli, co musí \emph{o tomto svědku platit}.

Na Obrázku \ref{figure:predicate-tableau-examples} vidíme příklad: položka $\T(\exists x)\neg P(x)$ v levém tablu je redukovaná, její redukcí vznikla položka $\T\neg P(c_0)$; $c_0\in C$ je pomocný symbol, na větvi se dosud nevyskytoval (a je první takový). Podobně pro položku $\F(\forall x)P(x)$ a $\F P(c_0)$ v pravém tablu.

\subsubsection{Všichni}
Při redukci položky typu ``všichni'' substituujeme za proměnnou $x$ libovolný \emph{konstantní term} $t$ rozšířeného jazyka $L_C$. Z položky tvaru $\T(\forall x)\varphi(x)$ tedy získáme položku $\T\varphi(x/t)$. 

Aby byla bezesporná větev \emph{dokončená}, budou na ní ale muset být položky $\T\varphi(x/t)$ pro \emph{všechny} konstantní $L_C$-termy $t$. (Musíme `použít' vše, co položka $\T(\forall x)\varphi(x)$ `říká'.) A stejně pro položku tvary $\mathrm{F}(\exists x)\varphi(x)$.

Ve výrokové logice jsme používali konvenci, že při připojování atomických tabel vynecháváme jejich kořeny (jinak bychom opakovali na větvi tutéž položku dvakrát). V predikátové logice použijeme stejnou konvenci, ale \emph{s výjimkou položek typu `svědek'}. U těch zapíšeme i kořen připojovaného atomického tabla. Proč to děláme? Abychom si připomněli, že s touto položkou ještě nejsme hotovi, že musíme připojit atomická tabla s jinými konstantními termy.

Na Obrázku \ref{figure:predicate-tableau-examples} v levém tablu \emph{není} položka $\T(\forall x)P(x)$ \emph{redukovaná}. Její \emph{první výskyt} (4. vrchol shora) jsme zredukovali, substituujeme term $t=c_0$, máme tedy $\varphi(x/t)=P(c_0)$. Připojili jsme atomické tablo v sestávající z téže položky v kořeni $\T(\forall x)P(x)$, kterou do tabla \emph{zapíšeme}, a z položky $\T P(c_0)$ pod ní. Zatímco \emph{první výskyt} položky $\T(\forall x)P(x)$ je tímto redukovaný, \emph{druhý výskyt} (7. vrchol shora) redukovaný není. Podobně pro položku $\F(\exists x)\neg P(x)$ v pravém tablu.

Tento poněkud technický přístup k definici \emph{redukovanosti} (výskytů) položek typu `všichni' se nám bude hodit v definici \emph{systematického tabla}.

\subsubsection{Jazyk}

Nadále budeme předpokládat, že jazyk $L$ je \emph{spočetný}.\footnote{Z hlediska výpočetní logiky to není velké omezení.} Z toho plyne, že každá $L$-teorie $T$ má jen spočetně mnoho axiomů, a také že konstantních termů v jazyce $L_C$ je jen spočetně mnoho. Toto omezení potřebujeme, neboť každé, i nekonečné tablo má jen spočetně mnoho položek, a musíme být schopni použít všechny axiomy dané teorie, a substituovat všechny konstantní termy jazyka $L_C$.

Nejprve také budeme předpokládat, že jde o jazyk \emph{bez rovnosti}, což je jednodušší. Problémem je, že \emph{tablo} je čistě syntaktický objekt, ale \emph{rovnost} má speciální sémantický význam, totiž musí být v každém modelu interpretována relací identity. Jak adaptovat metodu pro jazyky s rovností si ukážeme později. 

\section{Formální definice}

V této sekci definujeme všechny pojmy potřebné pro tablo metodu pro jazyky bez rovnosti. K jazykům s rovností se vrátíme v Sekci \ref{section:tableaux-equality}. 

Buď $L$ \emph{spočetný} jazyk bez rovnosti. Označme jako $L_C$ rozšíření jazyka $L$ o spočetně mnoho nových \emph{pomocných} konstantních symbolů $C=\{c_i\mid i\in \mathbb N\}$. Zvolme nějaké očíslování konstantních termů jazyka $L_C$, označme tyto termy $\{t_i\mid i\in\mathbb N\}$.

Mějme nějakou $L$-teorii $T$ a $L$-sentenci $\varphi$.

\subsection{Atomická tabla}

\emph{Položka} je nápis $\T\varphi$ nebo $\F\varphi$, kde $\varphi$ je nějaká $L_C$-sentence. Položky tvaru $\T(\exists x)\varphi(x)$ a $\F(\forall x)\varphi(x)$ jsou \emph{typu `svědek'}, položky tvaru $\T(\forall x)\varphi(x)$ a $\F(\exists x)\varphi(x)$ jsou \emph{typu `všichni'}

\emph{Atomická tabla} jsou položkami označkované stromy znázorněné v Tabulkách \ref{table:predicate-atomic-tableaux-logical} a \ref{table:predicate-atomic-tableaux-quantifiers}.

\begin{table}[htbp]
\centering
\begin{tabular}{@{}c||c|c|c|c|c@{}}
 & $\neg$ & $\land$ & $\lor$ & $\limplies$ & $\liff$  \\ \midrule \midrule
True
&  
\begin{forest}
[$\mathrm{T}\neg\varphi$ [$\mathrm{F}\varphi$]]
\end{forest}
&  
\begin{forest}
[$\mathrm{T}\varphi\land\psi$ [$\mathrm{T}\varphi$ [$\mathrm{T}\psi$]]]
\end{forest}
& 
\begin{forest}
[$\mathrm{T}\varphi\lor\psi$ [$\mathrm{T}\varphi$] [$\mathrm{T}\psi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{T}\varphi\limplies\psi$ [$\mathrm{F}\varphi$] [$\mathrm{T}\psi$]]
\end{forest}
&  
\begin{forest}
[$\mathrm{T}\varphi\liff\psi$ [$\mathrm{T}\varphi$ [$\mathrm{T}\psi$]] [$\mathrm{F}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
\\ \midrule
False 
& 
\begin{forest}
[$\mathrm{F}\neg\varphi$ [$\mathrm{T}\varphi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\land\psi$ [$\mathrm{F}\varphi$] [$\mathrm{F}\psi$]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\lor\psi$ [$\mathrm{F}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\limplies\psi$ [$\mathrm{T}\varphi$ [$\mathrm{F}\psi$]]]
\end{forest}
&
\begin{forest}
[$\mathrm{F}\varphi\liff\psi$ [$\mathrm{T}\varphi$ [$\mathrm{F}\psi$]] [$\mathrm{F}\varphi$ [$\mathrm{T}\psi$]]]
\end{forest}
\end{tabular}
\caption{Atomická tabla pro logické spojky; $\varphi$ a $\psi$ jsou libovolné $L_C$-sentence.}
\label{table:predicate-atomic-tableaux-logical}
\end{table}


\begin{table}[htbp]
    \centering
    \begin{tabular}{@{}c||c|c@{}}
     & $\forall$ & $\exists$ \\ \midrule \midrule
    True
    &  
    \begin{forest}
        [$\T(\forall x)\varphi(x)$ [$\T\varphi(x/t_i)$]]
    \end{forest}
    &  
    \begin{forest}
        [$\T(\exists x)\varphi(x)$ [$\T\varphi(x/c_i)$]]
    \end{forest}
    \\ \midrule
    False 
    &  
    \begin{forest}
        [$\F(\forall x)\varphi(x)$ [$\F\varphi(x/c_i)$]]
    \end{forest}
    &  
    \begin{forest}
        [$\F(\exists x)\varphi(x)$ [$\F\varphi(x/t_i)$]]
    \end{forest} 
    \end{tabular}
    \caption{Atomická tabla pro kvantifikátory; $\varphi$ je $L_C$-sentence, $x$ proměnná, $t_i$ libovolný konstantní $L_C$-term, $c_i\in C$ je nový pomocný konstantní symbol (který se dosud nevyskytuje na dané větvi konstruovaného tabla).}
    \label{table:predicate-atomic-tableaux-quantifiers}
\end{table}

\subsection{Tablo důkaz}

Definice v této části jsou téměř identické odpovídajícím definicím z výrokové logiky. Hlavní technický problém je jak definovat redukovanost položek typu `všichni' na větvi tabla: chceme aby za proměnnou byly substituovány \emph{všechny} možné konstantní $L_C$-termy $t_i$. 

\begin{definition}[Tablo]
    \emph{Konečné tablo z teorie $T$} je uspořádaný, položkami označkovaný strom zkonstruovaný aplikací konečně mnoha následujících pravidel:
    \begin{itemize}
        \item jednoprvkový strom označkovaný libovolnou položkou je tablo z teorie $T$,
        \item pro libovolnou položkou $P$ na libovolné větvi $V$, můžeme na konec větve $V$ připojit atomické tablo pro položku $P$, přičemž je-li $P$ typu `svědek', můžeme použít jen pomocný konstantní symbol $c_i\in C$, který se na větvi $V$ dosud nevyskytuje (pro položky typu `všichni' můžeme použít libovolný konstantní $L_C$-term $t_i$),
        \item na konec libovolné větve můžeme připojit položku $\mathrm{T}\alpha$ pro libovolný axiom teorie $\alpha\in T$.
    \end{itemize}
    \emph{Tablo z teorie $T$} je buď konečné, nebo i \emph{nekonečné}: v tom případě vzniklo ve spočetně mnoha krocích. Můžeme ho formálně vyjádřit jako sjednocení $\tau=\bigcup_{i\geq 0}\tau_i$, kde $\tau_i$ jsou konečná tabla z $T$, $\tau_0$ je jednoprvkové tablo, a $\tau_{i+1}$ vzniklo z $\tau_i$ v jednom kroku.\footnote{Sjednocení proto, že v jednotlivých krocích přidáváme do tabla nové vrcholy, $\tau_i$ je tedy podstromem $\tau_{i+1}$.}
    
    Tablo \emph{pro položku $P$} je tablo, které má položku $P$ v kořeni.
    \end{definition}
    
    Připomeňme konvenci, že pokud $P$ \emph{není} typu `všichni', potom kořen atomického tabla nebudeme zapisovat (neboť vrchol s položkou $P$ už v tablu je).

\begin{exercise}
    Ukažte v jednotlivých krocích jak byla tabla z Obrázku \ref{figure:predicate-tableau-examples} zkonstruována.
\end{exercise}


\begin{definition}[Tablo důkaz]
    \emph{Tablo důkaz} sentence $\varphi$ z teorie $T$ je \emph{sporné} tablo z teorie $T$ s položkou $\mathrm{F}\varphi$ v kořeni. Pokud existuje, je $\varphi$ \emph{(tablo) dokazatelná} z $T$, píšeme $T\proves\varphi$. (Definujme také \emph{tablo zamítnutí} jako sporné tablo s $\mathrm{T}\varphi$ v kořeni. Pokud existuje, je $\varphi$ \emph{(tablo) zamítnutelná} z $T$, tj. platí $T\proves\neg\varphi$.)  
    \begin{itemize}
        \item Tablo je \emph{sporné}, pokud je každá jeho větev sporná.
        \item Větev je \emph{sporná}, pokud obsahuje položky $\mathrm{T}\psi$ a $\mathrm{F}\psi$ pro nějaký výrok $\psi$, jinak je \emph{bezesporná}.
        \item Tablo je \emph{dokončené}, pokud je každá jeho větev dokončená.
        \item Větev je \emph{dokončená}, pokud 
        \begin{itemize}
            \item je sporná, nebo
            \item je každá položka na této větvi \emph{redukovaná} a zároveň větev obsahuje položku $\mathrm{T}\alpha$ pro každý axiom $\alpha\in T$.
        \end{itemize}
         
        \item Položka $P$ je \emph{redukovaná} na větvi $V$ procházející touto položkou, pokud 
        \begin{itemize}
            \item není typu `všichni' a při konstrukci tabla již došlo k jejímu rozvoji na $V$, tj. vyskytuje se na $V$ jako kořen atomického tabla.\footnote{Byť podle konvence tento kořen nezapisujeme.}
            \item je typu `všichni' a všechny její \emph{výskyty} na $V$ jsou na větvi $V$ \emph{redukované}.
        \end{itemize}
        \item Výskyt položky $P$ typu `všichni' na větvi $V$ je \emph{$i$-tý}, pokud má na $V$ právě $i-1$ předků označených touto položkou, a $i$-tý výskyt je \emph{redukovaný} na $V$, pokud
        \begin{itemize}
            \item položka $P$ má $(i+1)$-ní výskyt na $V$, a zároveň
            \item na $V$ se vyskytuje položka $\T\varphi(x/t_i)$ (je-li $P=\T(\forall x)\varphi(x)$) resp. $\F\varphi(x/t_i)$ (je-li $P=\F(\exists x)\varphi(x)$), kde $t_i$ je $i$-tý konstantní $L_C$-term.\footnote{Tj. (typicky) už jsme za $x$ substituovali term $t_i$.}
        \end{itemize} 
    \end{itemize}
\end{definition}
Všimněte si, že je-li položka typu `všichni' na nějaké větvi redukovaná, musí mít na této větvi nekonečně mnoho výskytů, a museli jsme v nich použít při substituci všechny možnosti, tj. všechny konstantní $L_C$-termy.
    
\begin{example}\label{example:tableau-proofs}
Jako příklad sestrojme tablo důkazy \emph{v logice} (z prázdné teorie) následujících sentencí: 
        \begin{enumerate}[(a)]
            \item $(\forall x)(P(x) \limplies Q(x)) \limplies ((\forall x)P(x) \limplies (\forall x)Q(x))$, kde $P,Q$ jsou unární relační symboly.
            \item $(\forall x)(\varphi(x) \land \psi(x)) \liff((\forall x)\varphi (x) \land (\forall x)\psi(x))$, kde $\varphi(x),\psi(x)$ jsou libovolné formule s jedinou volnou proměnnou $x$.
        \end{enumerate}
Výsledná tabla jsou na Obrázcích \ref{figure:predicate-tableau-more-examples-a} a \ref{figure:predicate-tableau-more-examples-b}. Dvojice sporných položek jsou znázorněny červeně. Rozmyslete si, jak byla tabla po krocích zkonstruována.
\begin{figure}[htbp]
\centering
\begin{forest}
    for tree={math content}
    [\F(\forall x)(P(x) \limplies Q(x)) \limplies ((\forall x)P(x) \limplies (\forall x)Q(x))
        [\T(\forall x)(P(x) \limplies Q(x))
            [\F(\forall x)P(x) \limplies (\forall x)Q(x)
                [\T(\forall x)P(x)
                    [\F(\forall x)Q(x)
                        [\textcolor{red}{\F Q(c_0)}
                            [\T(\forall x)P(x)
                                [\textcolor{red}{\T P(c_0)}
                                    [\T(\forall x)(P(x) \limplies Q(x))
                                        [\T P(c_0)\limplies Q(c_0)
                                            [\textcolor{red}{\F P(c_0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                            [\textcolor{red}{\T Q(c_0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]            
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]                
                ]
            ]
        ]
    ]
\end{forest}
\caption{Tablo důkaz z Příkladu \ref{example:tableau-proofs} (a).}
\label{figure:predicate-tableau-more-examples-a}
\end{figure} 

\begin{figure}[htbp]
\centering
\begin{forest}
for tree={math content}
[\F(\forall x)(\varphi(x) \land \psi(x)) \liff((\forall x)\varphi (x) \land (\forall x)\psi(x))
    [\T(\forall x)(\varphi(x) \land \psi(x))
        [\F(\forall x)\varphi (x) \land (\forall x)\psi(x)
            [\F(\forall x)\varphi (x)
                [\textcolor{red}{\F\varphi(c_0)}
                    [\T(\forall x)(\varphi(x) \land \psi(x))
                        [\T\varphi(c_0) \land \psi(c_0)
                            [\textcolor{red}{\T(\varphi(c_0)}
                                [\T(\psi(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                    ]
                ]
            ]
            [\F(\forall x)\psi(x)
                [\textcolor{red}{\F\psi(c_0)}
                    [\T(\forall x)(\varphi(x) \land \psi(x))
                        [\T\varphi(c_0) \land \psi(c_0)
                            [\T(\varphi(c_0)
                                [\textcolor{red}{\T(\psi(c_0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                    ]
                ]
            ]
        ]
    ]
    [\F(\forall x)(\varphi(x) \land \psi(x))
        [\T(\forall x)\varphi (x) \land (\forall x)\psi(x)
            [\T(\forall x)\varphi (x)
                [\T(\forall x)\psi(x)
                    [\F(\varphi(c_0) \land \psi(c_0))
                        [\textcolor{red}{\F\varphi(c_0)}
                            [\T(\forall x)\varphi (x)
                                [\textcolor{red}{\T\varphi(c_0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                        [\textcolor{red}{\F\psi(c_0)}
                            [\T(\forall x)\psi (x)
                                [\textcolor{red}{\T\psi(c_0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                            ]
                        ]
                    ]                
                ]
            ]
        ]
    ]
]
\end{forest}
\caption{Tablo důkaz z Příkladu \ref{example:tableau-proofs} (b). Konstantu $c_0$ můžeme použít jako \emph{novou} ve všech třech případech. Stačí, že se zatím nevyskytuje \emph{na dané větvi}.}
\label{figure:predicate-tableau-more-examples-b}
\end{figure} 
\end{example}


\subsection{Systematické tablo a konečnost důkazů}

V Sekci \ref{section:finiteness-and-systematicity-of-proofs} jsme ukázali, že neprodlužujeme-li sporné větve (což nemusíme dělat), potom sporné tablo, speciálně tablo důkaz, bude vždy konečný. Stejný důkaz funguje i v logice predikátové.

\begin{corollary}[Konečnost důkazů]\label{corollary:finiteness-of-proofs-predicate}
    Pokud $T\proves\varphi$, potom existuje i \emph{konečný} tablo důkaz $\varphi$ z $T$.
\end{corollary}
\begin{proof}
Stejný jako ve ve výrokové logice, viz důkaz Důsledku \ref{corollary:finiteness-of-proofs}.
\end{proof}

Ve stejné sekci jsme si ukázali konstrukci \emph{systematického tabla}. Tu lze také snadno adaptovat na predikátovou logiku. Musíme zajistit, abychom někdy zredukovali každou položku, použili každý axiom, a nově v predikátové logice také substituovali každý $L_C$ term $t_i$ za proměnnou v položkách typu `všichni'.

\begin{definition}
Mějme položku $R$ a teorii $T=\{\alpha_1,\alpha_2,\dots\}$. \emph{Systematické tablo} z teorie $T$ pro položku $R$ je tablo $\tau=\bigcup_{i\geq 0}\tau_i$, kde $\tau_0$ je jednoprvkové tablo s položkou $R$, a pro každé $i\geq 0$:

Buď $P$ položka v nejlevějším vrcholu $v$ na co nejmenší úrovni tabla $\tau_i$, která není redukovaná na nějaké bezesporné větvi procházející $P$ (resp. jde-li o položu typu `všichni', její \emph{výskyt} v tomto vrcholu není redukovaný). Potom $\tau_i'$ je tablo vzniklé z $\tau_i$ připojením atomického tabla pro $P$ na každou bezespornou větev procházející $v$, kde
\begin{itemize}
    \item je-li $P$ typu `všichni' a má-li ve vrcholu $v$ $k$-tý výskyt, potom za proměnnou substituujeme $k$-tý $L_C$-term $t_k$,
    \item je-li $P$ typu `svědek', potom na dané větvi $V$ za proměnnou substituujeme $c_i\in C$ s nejmenším možným $i$ (takovým, že na $V$ se $c_i$ dosud nevyskytuje).
\end{itemize}
Jinak, pokud taková položka $P$ a vrchol $v$ neexistují, tj. všechny položky jsou redukované, definujeme $\tau_i'=\tau_i$.

Tablo $\tau_{i+1}$ je potom tablo vzniklé z $\tau_i'$ připojením $\mathrm{T}\alpha_i$ na každou bezespornou větev $\tau_i'$, pokud $i\leq |T|$. Jinak (je-li $T$ konečná a už jsme použili všechny axiomy) tento krok přeskočíme a definujeme $\tau_{i+1}=\tau_i'$. 
\end{definition}

Stejně jako ve výrokové logice platí, že systematické tablo je vždy dokončené, a poskytuje konečný důkaz:

\begin{lemma}\label{lemma:systematic-is-finished-predicate}
    Systematické tablo je dokončené.
\end{lemma}
\begin{proof}
    Obdobný jako důkaz ve výrokové logice (Lemma \ref{lemma:systematic-is-finished}). Pro položky typu `všichni' si všimněte, že $k$-tý výskyt redukujeme v momentě, kdy na něj při konstrukci narazíme: připojením vrcholu s $(k+1)$-ním výskytem a substitucí $k$-tého $L_C$-termu $t_k$.
\end{proof}

\begin{corollary}[Systematičnost důkazů]\label{corollary:systematicity-of-proofs-predicate}
    Pokud $T\proves\varphi$, potom systematické tablo je (konečným) tablo důkazem $\varphi$ z $T$.
\end{corollary}
\begin{proof}
    Stejný jako důkaz ve výrokové logice (Důsledek \ref{corollary:systematicity-of-proofs}).
\end{proof}


\section{Jazyky s rovností} \label{section:tableaux-equality}

Nyní si ukážeme, jak aplikovat tablo metodu na jazyky s rovností. Co je to rovnost? V matematice může v různém kontextu znamenat různé relace. Platí $1+0=0+1$? Mluvíme-li o celých číslech, pak ano, ale máme-li na mysli aritmetické výrazy (nebo např. termy v jazyce těles), potom si levá a pravá strana nejsou rovny: jde o jiné výrazy. \footnote{Podobně např. $t_1=t_2$ v Prologu neznamená, že jde o tentýž term, ale že termy $t_1$ a $t_2$ jsou \emph{unifikovatelné}, viz kapitola o rezoluci v predikátové logice.}

Představte si, že máme teorii $T$ v jazyce s rovností obsahujícím konstantní symboly $c_1,c_2$, unární funkční symbol $f$ a unární relační symbol $P$. Mějme nějaké dokončené tablo z této teorie, a v něm bezespornou větev, na kterém najdeme položku $\T c_1=c_2$. Budeme chtít sestrojit \emph{kanonický model} $\A$ pro tuto větev, podobně jako ve výrokové logice. Položka bude znamenat, že v kanonickém modelu platí $c_1^\A =^\A c_2^\A$, tj. $(c_1^\A,c_2^\A)\in =^\A$. To nám ale nestačí, chceme také, aby platilo také např.:
\begin{itemize}
    \item $c_2^\A =^\A c_1^\A$,
    \item $f^\A(c_1^\A) =^\A f^\A(c_2^\A)$,
    \item $c_1^\A\in P^\A$, právě když $c_2^\A\in P^\A$.
\end{itemize}
Obecně tedy chceme, aby relace $=^\A$ byla tzv. \emph{kongruencí},\footnote{Název pochází z kongruence modulo $n$, která je kongruencí v tomto smyslu na množině všech celých čísel, např. splňuje: $a+b\equiv c+d\pmod n$ kdykoliv $a\equiv c\pmod n$ a $b\equiv d\pmod n$.} tj. ekvivalencí, která se chová `dobře' vůči funkcím a relacím struktury $\A$. Toho docílíme tak, že k teorii $T$ přidáme tzv. \emph{axiomy rovnosti}, které tyto vlastnosti vynutí, a tablo sestrojíme z výsledné teorie $T^*$.

V modelu $\A$ potom bude relace $=^\A$ kongruencí. To nám ale nestačí, chceme, aby rovnost byla \emph{identita}, tj. aby $(a,b)\in=^\A$ platilo jedině když $a$ a $b$ jsou týmž prvkem univerza. Toho docílíme identifikací všech $=^\A$-ekvivalentních prvků do jediného prvku. Této konstrukci se říká \emph{faktorstruktura} podle kongruence $=^\A$.\footnote{Stejně jako grupa $\mathbb Z_n$ je faktorstrukturou grupy $\mathbb Z$ podle $\equiv\pmod n$; např. prvek $2\in\mathbb Z_n$ představuje množinu všech celých čísel, jejichž zbytek po dělení $n$ je roven 2.} Nyní tyto pojmy formalizujeme.

\begin{definition}[Kongruence]
    Mějme ekvivalenci $\sim$ na množině $A$, funkci $f\colon A^n\to A$, a relaci $R\subseteq A^n$. Říkáme, že $\sim$ je
    \begin{itemize}
        \item \emph{kongruencí pro funkci $f$}, pokud pro všechna $x_i,y_i\in A$ taková, že $x_i\sim y_i$ ($1\leq i\leq n$) platí $f(x_1,\dots,x_n)\sim f(y_1,\dots,y_n)$,
        \item \emph{kongruencí pro relaci $f$}, pokud pro všechna $x_i,y_i\in A$ taková, že $x_i\sim y_i$ ($1\leq i\leq n$) platí $f(x_1,\dots,x_n)\sim f(y_1,\dots,y_n)$.
    \end{itemize}    
    \emph{Kongruence struktury} $\A$ je ekvivalence $\sim$ na množině $A$, která je kongruencí pro všechny funkce a relace $\A$. 
\end{definition}

\begin{definition}[Faktorstruktura]
    Mějme strukturu $\A$ a její kongruenci $\sim$. \emph{Faktorstruktura (podílová struktura)} $\A$ podle $\sim$ je struktura $\A/_\sim$ v témž jazyce, jejíž univerzum $A/_\sim$ je množina všech rozkladových tříd $A$ podle $\sim$, a jejíž funkce a relace jsou definované \emph{pomocí reprezentantů}, tj:
    \begin{itemize}
        \item $f^{\A/_\sim}([x_1]_\sim,\dots,[x_n]_\sim)=[f^\A(x_1,\dots,x_n)]_\sim$, pro každý ($n$-ární) funkční symbol $f$, a
        \item $R^{\A/_\sim}([x_1]_\sim,\dots,[x_n]_\sim)$ právě když $R^\A(x_1,\dots,x_n)$, pro každý ($n$-ární) relační symbol~$R$.
    \end{itemize} 
    
\end{definition}


\begin{definition}[Axiomy rovnosti]
    \emph{Axiomy rovnosti} pro jazyk $L$ s rovností jsou následující:
    \begin{enumerate}[(i)]
        \item $x=x$,
        \item $x_1=y_1\land\cdots\land x_n=y_n\limplies f(x_1,\dots,x_n)=f(y_1,\dots,y_n)$ pro každý $n$-ární funkční symbol $f$ jazyka $L$,
        \item $x_1=y_1\land\cdots\land x_n=y_n\limplies (R(x_1,\dots,x_n)\limplies R(y_1,\dots,y_n))$ pro každý $n$-ární relační symbol $R$ jazyka $L$ \emph{včetně rovnosti}.
    \end{enumerate}
\end{definition}

\begin{exercise}
    První z axiomů rovnosti znamená reflexivitu relace $=^\A$. Kam se poděly symetrie a tranzitivita? Ukažte, že plynou z axiomu (iii) pro symbol rovnosti $=$.
\end{exercise}

Z axiomů $(i)$ a $(iii)$ tedy plyne, že relace $=^\A$ je ekvivalence na $A$, a axiomy $(ii)$ a $(iii)$ vyjadřují, že $=^\A$ je kongruencí $\A$. V tablo metodě v případě jazyka s rovností implicitně přidáme všechny axiomy rovnosti:

\begin{definition}[Tablo důkaz s rovností]
    Je-li $T$ teorie v jazyce $L$ s rovností, potom označme jako $T^*$ rozšíření teorie $T$ o generální uzávěry\footnote{Neboť v tablo metodě potřebujeme \emph{sentence}.} axiomů rovnosti pro jazyk $L$. \emph{Tablo důkaz} z teorie $T$ je \emph{tablo důkaz} z $T^*$, podobně pro tablo zamítnutí (a obecně jakékoliv tablo).    
\end{definition}

Platí následující jednoduché pozorování:
\begin{observation}
    Jestliže $\A\models T^*$, potom platí i $\A/_{=^\A}\models T^*$, a ve struktuře $\A/_{=^\A}$ je symbol rovnosti interpretován jako identita. Na druhou stranu, v každém modelu, ve kterém je symbol rovnosti interpretován jako identita, platí axiomy rovnosti.
\end{observation}

Toto pozorování využijeme při konstrukci \emph{kanonického modelu}, který budeme potřebovat v důkazu Věty o úplnosti. Nejprve ale dokážeme Větu o korektnosti.

\section{Korektnost a úplnost}

V této sekci dokážeme, že tablo metoda je i v predikátové logice korektní a úplná. Důkazy obou vět mají stejnou strukturu jako ve výrokové logice, liší se jen v implementačních detailech.

\subsection{Věta o korektnosti}

Model (struktura) $\A$ se \emph{shoduje} s položkou $P$, pokud
$P=\mathrm{T}\varphi$ a $\A\models\varphi$, nebo $P=\mathrm{F}\varphi$ a $\A\not\models\varphi$. Dále $\A$ se shoduje s větví $V$, pokud se shoduje s každou položkou na této větvi.

Ukážeme nejprve pomocné lemma analogické Lemmatu \ref{lemma:agrees-with-branch}:
\begin{lemma}\label{lemma:agrees-with-branch}
    Shoduje-li se model $\A$ teorie $T$ s položkou v kořeni tabla z teorie $T$ (v jazyce $L$), potom lze $\A$ expandovat do jazyka $L_C$ tak, že se shoduje s některou větví v tablu.
\end{lemma}
Všimněte si, že stačí expandovat $\A$ o nové konstanty $c^A$ vyskytující se na větvi $V$. Ostatní konstantní symboly lze interpretovat libovolně.

\begin{proof}
    Mějme tablo $\tau=\bigcup_{i\geq 0}\tau_i$ z teorie $T$ a model $\A\in\M_L(T)$ shodující se s kořenem $\tau$, tedy s (jednoprvkovou) větví $V_0$ v (jednoprvkovém) $\tau_0$.
    
    Indukcí podle $i$ najdeme posloupnost větví $V_i$ a expanzí $\A_i$ modelu $\A$ o konstanty $c^A\in C$ vyskytující se na $V_i$ takových, že $V_i$ je větev v tablu $\tau_i$ shodující se s modelem $\A_i$, $V_{i+1}$ je prodloužením $V_i$, a $\A_{i+1}$ je expanzí $\A_i$ (mohou si být i rovny). Požadovaná větev tabla $\tau$ je potom $V=\bigcup_{i\geq 0}V_i$. Expanzi modelu $\A$ do jazyka $L_C$ získáme jako `limitu' expanzí $\A_i$, tj. vyskytuje-li se symbol $c\in C$ na $V$, vyskytuje se na nějaké z větví $V_i$ a interpretujeme ho stejně jako v $\A_i$ (ostatní pomocné symboly interpretujeme libovolně).
    \begin{itemize}
        \item Pokud $\tau_{i+1}$ vzniklo z $\tau_i$ bez prodloužení větve $V_i$, definujeme $V_{i+1}=V_i$ a $\A_{i+1}=\A_{i}$.
        \item Pokud $\tau_{i+1}$ vzniklo z $\tau_i$ připojením položky $\mathrm{T}\alpha$ (pro nějaký axiom $\alpha\in T$) na konec větve  $V_i$, definujeme $V_{i+1}$ jako tuto prodlouženou větev a $\A_{i+1}=\A_i$ (nepřidali jsme žádný nový pomocný konstantní symbol). Protože $\A_{i+1}$ je modelem $T$, platí v něm axiom $\alpha$, tedy shoduje se i s novou položkou $\mathrm{T}\alpha$.
        \item Nechť $\tau_{i+1}$ vzniklo z $\tau_i$ připojením atomického tabla pro nějakou položku $P$ na konec větve $V_i$. Protože se model $\A_i$ shoduje s položkou $P$ (která leží na větvi $V_i$), shoduje se i s kořenem připojeného atomického tabla.
        \begin{itemize}
            \item Pokud jsme připojili atomické tablo pro logickou spojku, položíme $\A_{i+1}=\A_i$ (nepřidali jsme nový pomocný symbol). Protože $\A_{i+1}$ se shoduje s kořenem atomického tabla, shoduje se i s některou z jeho větví (stejně jako ve výrokové logice); definujeme $V_{i+1}$ jako prodloužení $V_i$ o tuto větev.
            \item Je-li položka $P$ typu `svědek': Pokud je $P=\T(\exists x)\varphi(x)$, potom $\A_i\models(\exists x)\varphi(x)$, tedy existuje $a\in A$ takové, že $\A_i\models\varphi(x)[e(x/a)]$. Větev $V_{i+1}$ definujeme jako prodloužení $V_i$ o nově přidanou položku $\T\varphi(x/c)$ a model $\A_{i+1}$ jako expanzi $\A_i$ o konstantu $c^A=a$. Případ $P=\F(\forall x)\varphi(x)$ je obdobný.
            \item Je-li položka $P$ typu `všichni', větev $V_{i+1}$ definujeme jako prodloužení $V_i$ o atomické tablo. Nově přidaná položka je $\T\varphi(x/t)$ nebo $\F\varphi(x/t)$ pro nějaký $L_C$-term $t$. Předpokládejme, že jde o první z těchto dvou možností, pro druhou je důkaz analogický. 
            Model $\A_{i+1}$ definujeme jako \emph{libovolnou} expanzi $\A_i$ o nové konstanty vyskytující se v $t$.    
            Protože $\A_i\models(\forall x)\varphi(x)$, platí i $\A_{i+1}\models(\forall x)\varphi(x)$ a tedy i $\A_{i+1}\models\varphi(x/t)$; model $\A_{i+1}$ se tedy shoduje s větví $V_i$.
        \end{itemize}       
    \end{itemize}
\end{proof}

Připomeňme stručně myšlenku důkazu Věty o korektnosti: Pokud by existoval důkaz a zároveň protipříklad, protipříklad by se musel shodovat s některou větví důkazu, ty jsou ale všechny sporné. Důkaz je tedy téměř stejný jako ve výrokové logice.

\begin{theorem}[O korektnosti]
Je-li výrok $\varphi$ tablo dokazatelný z teorie $T$, potom je $\varphi$ pravdivý v $T$, tj. $T\proves\varphi\ \Rightarrow\ T\models\varphi$.    
\end{theorem}

\begin{proof}
Předpokládejme pro spor, že $T\not\models\varphi$, tj. existuje $\A\in\M(T)$ takový, že $\A\not\models\varphi$. Protože $T\proves\varphi$,  existuje sporné tablo z $T$ s $\mathrm{F}\varphi$ v kořeni. Model $\A$ se shoduje s $\mathrm{F}\varphi$, tedy podle Lemmatu \ref{lemma:agrees-with-branch} lze expandovat do jazyka $L_C$ tak, že se expanze shoduje s nějakou větví $V$. Všechny větve jsou ale sporné.
\end{proof}

\subsection{(draft) Věta o úplnosti}\todo

Stejně jako ve výrokové logice ukážeme, že \emph{bezesporná} větev v \emph{dokončeném} tablo důkazu poskytuje protipříklad: model teorie $T$, který se shoduje s položkou $\mathrm{F}\varphi$ v kořeni tabla, tj. neplatí v něm $\varphi$. Takových modelů může být více, definujeme proto opět jeden konkrétní, \emph{kanonický}.

Model musí mít nějakou doménu. Jak ji získat z tabla, což je čistě sémantický objekt? Využijeme standardní (v matematice) trik: ze syntaktických objektů uděláme sémantické. Konkrétně, za doménu zvolíme množinu všech \emph{konstantních termů} jazyka $L_C$.\footnote{Tj. termů zbudovaných aplikací funkčních symbolů jazyka $L$ na konstantní symboly jazyka $L$ (má-li nějaké) a pomocné konstantní symboly z $C$.} Ty chápeme jako konečné řetězce. V následujícím budeme někdy (neformálně) místo termu $t$ psát ``$t$'', abychom zdůraznili, že v daném místě chápeme $t$ jako řetězec znaků, a ne např. jako termovou funkci, kterou je třeba vyhodnotit.\footnote{Srovnejte aritmetický výraz ``1+1'' a 1+1=2.}

\begin{definition}[Kanonický model]\label{definition:canonical-model-predicate}
Mějme teorii $T$ v jazyce $L=\langle\mathcal F,\mathcal R\rangle$ a nechť $V$ je bezesporná větev nějakého dokončeného tabla z teorie $T$. Potom \emph{kanonický model} pro $V$ je $L_C$-struktura $\A=\langle A,\mathcal F^\mathcal A\cup C^\mathcal A,\mathcal R^\mathcal A\rangle$ definovaná následovně:

Je-li jazyk $L$ bez rovnosti, potom:
\begin{itemize}
    \item Doména $A$ je množina všech konstantních $L_C$-termů.
    \item Pro každý $n$-ární relační symbol $R\in\mathcal R$ a ``$s_1$'', \dots, ``$s_n$'' z $A$:
    $$
    (\text{``$s_1$''},\dots,\text{``$s_n$''})\in R^\mathcal A\text{ právě když na větvi $V$ je položka $\T R(s_1,\dots,s_n)$}
    $$
    \item Pro každý $n$-ární funkční symbol $f\in\mathcal F$ a ``$s_1$'', \dots, ``$s_n$'' z $A$:
    $$
    f^\mathcal A(\text{``$s_1$''},\dots,\text{``$s_n$''})=\text{``$f(s_1,\dots,s_n)$''}
    $$
    Speciálně, pro konstantní symbol $c$ máme $c^\mathcal A=\text{``$c$''}$.
\end{itemize}
Funkci $f^\mathcal A$ tedy interpretujeme jako `vytvoření' nového termu ze symbolu $f$ a vstupních termů (řetězců). 

Nechť je $L$ jazyk s rovností. Připomeňme, že naše tablo je nyní z teorie $T^*$, tj. z rozšíření~$T$ o axiomy rovnosti pro $L$. Nejprve vytvoříme kanonický model $\mathcal B$ pro $V$ jakoby byl $L$ bez rovnosti (jeho doména $B$ je tedy množina všech konstantních $L_C$-termů). Dále definujeme relaci $=^B$ stejně jako pro ostatní relační symboly:
$$
\text{``$s_1$''}=^B\text{``$s_2$''}\text{ právě když na větvi $V$ je položka $\T s_1=s_2$}
$$
\emph{Kanonický model} pro $V$ je potom faktorstruktura $\A=\B/_{=^B}$.
\end{definition}

Jak plyne z diskuze v Sekci \ref{section:tableaux-equality}, relace $=^B$ je opravdu kongruence struktury $\B$, definice je tedy korektní, a relace $=^\A$ je identita na $A$. Všimněte si, že v jazyce bez rovnosti je kanonický model vždy spočetně nekonečný. V jazyce s rovností může ale být konečný, jak uvidíme v následujících příkladech.

\todo Příklady

\todo Cvičení $x=y\lor y=z\lor x=z$

% from slides:
\subsubsection*{Kanonický model - příklad}
    
    Nechť teorie \myblue{$T=\{(\forall x)R(f(x))\}$} je jazyka \myblue{$L=\langle R,f,d \rangle$}. Systematické tablo
    \smallskip
    
     pro \myblue{$F\neg R(d)$} z $T$ obsahuje jedinou větev $V$ a ta je bezesporná.
    \bigskip
    
    Kanonický model \myblue{$\mathcal{A}=\langle A, R^A, f^A, d^A, c_i^A\rangle_{i\in \mathbb{N}}$} z $V$ je pro jazyk $L_C$ a platí
    \vspace{-1mm}
    \mygreen{\begin{align*}
    A&=\{d,f(d),f(f(d)),\dots,c_0,f(c_0),f(f(c_0)),\dots,c_1,f(c_1),f(f(c_1)),\dots\},\\
    d^A&=d,\quad c^A_i=c_i\ \ \text{pro}\ \ i\in \mathbb{N},\\
    f^A(d)&=\text{``}f(d)\text{''},\ \ f^A(f(d))=\text{``}f(f(d))\text{''},\ \ f^A(f(f(d)))=\text{``}f(f(f(d)))\text{''},\ \dots\\
    R^A&=\{d,f(d),f(f(d)),\dots,f(c_0),f(f(c_0)),\dots,f(c_1),f(f(c_1)),\dots\}.
    \end{align*}}
    Redukt $\mathcal{A}$ na jazyk $L$ je \myblue{$\mathcal{A}'=\langle A, R^A, f^A, d^A\rangle$}.
    
    \subsubsection*{Kanonický model s rovností - příklad}
        
        Nechť \myblue{$T=\{(\forall x)R(f(x)),\ (\forall x)(x=f(f(x)))\}$} je nad \myblue{$L=\langle R,f,d \rangle$} s rovností.
        \smallskip
        
        Systematické tablo pro \myblue{$F\neg R(d)$} z $T^*$ obsahuje bezespornou větev $V$.
        \bigskip
        
        V kanonickém modelu \myblue{$\mathcal{A}=\langle A, R^A, =^A,f^A, d^A, c_i^A\rangle_{i\in \mathbb{N}}$} z $V$ pro relaci $=^A$ platí
        \vspace{-2mm}
        \mygreen{$$s_1=^A s_2\quad\Leftrightarrow\quad s_1=f(\cdots (f(s_2)\cdots)\ \ \text{nebo}\ \ s_2=f(\cdots (f(s_1)\cdots),$$}
        
        \vspace{-6mm}
        kde $f$ je aplikováno \mdef{$2i$}-krát pro nějaké $i\in \mathbb{N}$.
        \bigskip
        
        Kanonický model s rovností z $V$ je \myblue{$\mathcal{B}=(\mathcal{A}/\!=^A)=\langle A/\!=^A, R^B,f^B, d^B, c_i^B\rangle_{i\in \mathbb{N}}$}
        \vspace{-1mm}
        \mygreen{\begin{align*}
        (A/\!=^A)&=\{[d]_{=^A},[f(d)]_{=^A},[c_0]_{=^A},[f(c_0)]_{=^A},[c_1]_{=^A},[f(c_1)]_{=^A},\dots\},\\
        d^{B}&=[d]_{=^A},\quad c^{B}_i=[c_i]_{=^A}\ \ \text{pro}\ \ i\in \mathbb{N},\\
        f^{B}([d]_{=^A})&=[f(d)]_{=^A},\ \ f^{B}([f(d)]_{=^A})=[f(f(d))]_{=^A}= [d]_{=^A},\ \ \dots\\
        R^{B}&=(A/\!=^A).
        \end{align*}}
        Redukt $\mathcal{B}$ na jazyk $L$ je \myblue{$\mathcal{B}'=\langle A/\!=^A, R^B, f^B, d^B\rangle$}.
        
% :from slides

% \begin{lemma}\label{lemma:canonical-model-agrees}
%     Kanonický model pro (bezespornou dokončenou) větev $V$ se shoduje s $V$.
% \end{lemma}
% \begin{proof}
% Ukážeme, že kanonický model $v$ se shoduje se všemi položkami $P$ na větvi $V$, a to indukcí podle struktury výroku v položce.\footnote{Připomeňme, že to znamená indukci podle hloubky stromu výroku.} Nejprve základ indukce:
% \begin{itemize}
%     \item Je-li $P=\mathrm{T}p$ pro nějaký prvovýrok $p\in\mathbb P$, máme podle definice $v(p)=1$; $v$ se s $P$ shoduje.
%     \item Je-li $P=\mathrm{F}p$, potom se na větvi $V$ nemůže vyskytovat položka $\mathrm{T}p$, jinak by $V$ byla sporná. Podle definice máme $v(p)=0$ a $v$ se s $P$ opět shoduje.
% \end{itemize}
% Nyní indukční krok. Rozebereme dva případy, ostatní se dokáží obdobně.
% \begin{itemize}
%     \item Nechť $P=\mathrm{T}\varphi\land\psi$. Protože je $V$ dokončená větev, je na ní položka $P$ redukovaná. To znamená, že se na $V$ vyskytují i položky $\mathrm{T}\varphi$ a $\mathrm{T}\psi$. Podle indukčního předpokladu se s nimi model $v$ shoduje, tedy $v\models\varphi$ a $v\models\psi$. Takže platí i $v\models\varphi\land\psi$ a $v$ se shoduje s $P$.
%     \item Nechť $P=\mathrm{F}\varphi\land\psi$. Protože je $P$ na $V$ redukovaná, vyskytuje se na $V$ položka $\mathrm{F}\varphi$ nebo položka $\mathrm{F}\psi$. Platí tedy $v\not\models\varphi$ nebo $v\not\models\psi$, z čehož plyne $v\not\models\varphi\land\psi$ a $v$ se shoduje s $P$.
% \end{itemize}
% \end{proof}

% \begin{theorem}[O úplnosti]
%     Je-li výrok $\varphi$ pravdivý v teorii $T$, potom je tablo dokazatelný z $T$, tj. $T\models\varphi\ \Rightarrow\ T\proves\varphi$.    
% \end{theorem}

% \begin{proof}
% Ukážeme, že libovolné \emph{dokončené} (tedy např. i \emph{systematické}) tablo z $T$ s položkou $\mathrm{F}\varphi$ v kořeni je nutně sporné. Důkaz provedeme sporem: kdyby takové tablo nebylo sporné, existovala by v něm bezesporná (dokončená) větev $V$. Uvažme kanonický model $v$ pro tuto větev. Protože je $V$ dokončená, obsahuje $\mathrm{T}\alpha$ pro všechny axiomy $\alpha\in T$. Model $v$ se podle Lemmatu \ref{lemma:canonical-model-agrees} shoduje se všemi položkami na $V$, splňuje tedy všechny axiomy a máme $v\models T$. Protože se ale $v$ shoduje i s položkou $\mathrm{F}\varphi$ v kořeni, máme $v\not\models\psi$, což znamenám, že $T\not\models\psi$, spor. Tablo tedy muselo být sporné, tj. být tablo důkazem $\varphi$ z $T$.
% \end{proof}

% \begin{proof}[Důkaz Důsledku \ref{corollary:systematicity-of-proofs}]
% Z předchozího důkazu také dostáváme `systematičnost důkazů', tj. že důkaz můžeme vždy hledat konstrukcí systematického tabla: Pokud $T\models\varphi$, tak je i systematické tablo pro položku $\mathrm{F}\varphi$ nutně sporné, a je tedy tablo důkazem $\varphi$ z $T$.
% \end{proof}

% \begin{exercise}
%     Ověřte zbývající případy v důkazu Lemmatu \ref{lemma:canonical-model-agrees}.
% \end{exercise}

% \begin{exercise}
%     Popište, jak vypadají \emph{všechny} modely shodující se s danou bezespornou dokončenou větví.
% \end{exercise}

% \begin{exercise}
%     Navrhněte postup, kterým můžeme za použití tablo metody najít všechny modely dané teorie $T$.
% \end{exercise}


% from slides:
\subsubsection*{Úplnost}
    {\bf \myblue{Lemma}}\ \ {\it Kanonický model $\mathcal{A}$ z bezesporné dok. větve $V$ se \myblue{shoduje} s $V$.}
    \smallskip
    
    {\it \myblue{Důkaz}}\ \ Indukcí dle struktury sentence vyskytující se v položce na $V$.
    \begin{itemize}
    \item Pro $\varphi$ \myblue{atomickou}, je-li \mygreen{$T\varphi$} na $V$, je \mygreen{$\mathcal{A} \models \varphi$} dle $(3)$. Je-li \mygreen{$F\varphi$} na $V$, není
    \vspace{0.4mm}
    
    \mygreen{$T\varphi$} na $V$, neboť $V$ je bezesporná, a tedy \mygreen{$\mathcal{A}\models \neg \varphi$} dle $(3)$.
    %\smallskip
    \vspace{0.4mm}
    
    \item Je-li \mygreen{$T(\varphi \mand \psi)$} na $V$, je \mygreen{$T\varphi$} a \mygreen{$T\psi$} na $V$, neboť $V$ je dokončená. Dle
    \vspace{0.4mm}
    
    indukčního předpokladu je \mygreen{$\mathcal{A}\models \varphi$} a \mygreen{$\mathcal{A}\models \psi$}, tedy \mygreen{$\mathcal{A}\models \varphi \mand \psi$}.
    %\smallskip
    \vspace{0.4mm}
    
    \item Je-li \mygreen{$F(\varphi \mand \psi)$} na $V$, je \mygreen{$F\varphi$} nebo \mygreen{$F\psi$} na $V$, neboť $V$ je dokončená. Dle
    \vspace{0.4mm}
    
    indukčního předpokladu je \mygreen{$\mathcal{A}\models \neg\varphi$} nebo \mygreen{$\mathcal{A}\models \neg\psi$}, tedy \mygreen{$\mathcal{A}\models \neg(\varphi \mand \psi)$}.
    %\smallskip
    \vspace{0.4mm}
    
    \item Pro ostatní spojky obdobně jako v předchozích dvou případech.
    %\smallskip
    \vspace{0.4mm}
    
    \item Je-li \mygreen{$T(\forall x)\varphi(x)$} na $V$, je \mygreen{$T\varphi(x/t)$} na $V$ pro každé $t\in A$, neboť $V$ je
    \vspace{0.4mm}
    
    dokončená. Dle indukčního předpokladu je \mygreen{$\mathcal{A}\models \varphi(x/t)$} pro každé $t\in A$,
    \vspace{0.4mm}
    
    tedy \mygreen{$\mathcal{A}\models (\forall x)\varphi(x)$}. Obdobně pro \mygreen{$F(\exists x)\varphi(x)$} na $V$.
    %\smallskip
    \vspace{0.4mm}
    
    \item Je-li \mygreen{$T(\exists x)\varphi(x)$} na $V$, je \mygreen{$T\varphi(x/c)$} na $V$ pro nějaké $c\in A$, neboť $V$ je
    \vspace{0.4mm}
    
    dokončená. Dle indukčního předpokladu je \mygreen{$\mathcal{A}\models \varphi(x/c)$}, tedy
    \vspace{0.4mm}
    
    \mygreen{$\mathcal{A}\models (\exists x)\varphi(x)$}. Obdobně pro \mygreen{$F(\forall x)\varphi(x)$} na $V$. $\qed$
    \end{itemize}
    
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
    
    \subsubsection*{Věta o úplnosti}
    {\it Ukážeme, že tablo metoda ve predikátové logice je \myblue{úplná}.}
    \medskip
    
    {\bf \myblue{Věta}}\ \ {\it Pro každou teorii $T$ a sentenci $\varphi$, je-li $\varphi$ pravdivá v $T$, je $\varphi$ tablo
    \vspace{0.4mm}
    %\smallskip
    
    dokazatelná z $T$, tj. $T \models \varphi\ \Rightarrow\ T \vdash \varphi$.}
    \medskip
    
    {\it \myblue{Důkaz}}\ \ Nechť $\varphi$ je pravdivá v $T$. Ukážeme, že libovolné \myblue{dokončené} tablo
    \vspace{0.4mm}
    %\smallskip
    
    (např. \myblue{systematické}) $\tau$ z teorie $T$ s položkou \myblue{$F\varphi$} v kořeni je \myblue{sporné}.
    %\vspace{0.4mm}
    %\smallskip
    
    \begin{itemize}
    \item Kdyby ne, v tablu $\tau$ je nějaká bezesporná větev $V$.
    \vspace{0.4mm}
    %\smallskip
    
    \item Dle předchozího lemmatu existuje struktura $\mathcal{A}$ pro jazyk $L_C$ shodující se
    \vspace{0.4mm}
    %\smallskip
    
    s větví $V$, speciálně s položkou $F\varphi$ v kořeni, tj. $\mathcal{A}\models \neg \varphi$.
    \vspace{0.4mm}
    %\smallskip
    
    \item Nechť $\mathcal{A}'$ je redukt struktury $\mathcal{A}$ na původní jazyk $L$. Platí $\mathcal{A}'\models \neg \varphi$.
    \vspace{0.4mm}
    
    \item Jelikož větev $V$ je dokončená, obsahuje $T\psi$ pro každé $\psi \in T$.
    \vspace{0.4mm}
    %\smallskip
    
    \item Tedy $\mathcal{A}'$ je modelem $T$ (neboť $\mathcal{A'}$ se shoduje s $T\psi$ pro každé $\psi \in T$).
    \vspace{0.4mm}
    %\smallskip
    
    \item To je ale ve sporu s tím, že $\varphi$ platí v každém modelu teorie $T$.
    \end{itemize}
    \vspace{0.4mm}
    %\smallskip
    
    Tedy tablo $\tau$ je důkazem $\varphi$ z $T$. $\qed$
    
% :from slides


\section{(draft) Důsledky korektnosti a úplnosti}\todo

% from slides:
{\it Zavedeme syntaktické varianty již definovaných sémantických pojmů.}
\medskip

Nechť $T$ je teorie jazyka $L$. Je-li sentence $\varphi$ dokazatelná z $T$, řekneme, že
\smallskip

$\varphi$ je \mdef{věta} (\mdef{teorém}) teorie $T$. Množinu vět teorie $T$ označme
\vspace{-2mm}
\mygreen{$$\mathrm{Thm}^{L}(T)=\{\varphi \in \mathrm{Fm}_L \mid T \vdash \varphi\}.$$}

\vspace{-4mm}
Řekneme, že teorie $T$ je
\begin{itemize}
\item \mdef{sporná}, jestliže je v $T$ dokazatelný $\bot$ (spor), jinak je \mdef{bezesporná},
\smallskip

\item \mdef{kompletní}, jestliže není sporná a každá \myblue{sentence} je v ní dokazatelná či
\smallskip

zamítnutelná, tj. $T \vdash \varphi$ či $T \vdash \neg \varphi$.
\smallskip

\item \mdef{extenze} teorie $T'$ jazyka $L'$, jestliže $L' \subseteq L$ a $\mathrm{Thm}^{L'}\!(T')\subseteq \mathrm{Thm}^{L}\!(T)$,
\smallskip

o extenzi $T$ teorie $T'$ řekneme, že je \mdef{jednoduchá}, pokud $L=L'$, a
\smallskip

\mdef{konzervativní}, pokud $\mathrm{Thm}^{L'}\!(T')=\mathrm{Thm}^{L}\!(T)\cap \mathrm{\mathrm{Fm}_{L'}}$,
\smallskip

\item \mdef{ekvivalentní} s teorií $T'$, jestliže $T$ je extenzí $T'$ a $T'$ je extenzí $T$.
\end{itemize}

{\it Z korektnosti a úplnosti tablo metody vyplývá, že předchozí pojmy se
\smallskip

shodují se svými sémantickými variantami.}
\bigskip

{\bf \myblue{Důsledek}}\ \ {\it Pro každou teorii $T$ a sentence $\varphi$, $\psi$ jazyka $L$,
\smallskip

\begin{itemize}%[\hspace{2mm}$(1)$]
\item $T \vdash \varphi$ právě když $T \models \varphi$,
\smallskip

\item $\mathrm{Thm}^{L}\!(T)=\theta^{L}(T)$,
\smallskip

\item $T$ je sporná, právě když je sémanticky sporná, tj. nemá model,
\smallskip

\item $T$ je kompletní, právě když je sémanticky kompletní, tj. má až na
\smallskip

\myblue{elementární ekvivalenci} jediný model,
\smallskip

\item $T,\varphi \vdash \psi$ právě když $T \vdash \varphi \to \psi$ (\myblue{Věta o dedukci}).
\end{itemize}}
\medskip

%{\it \myblue{Důkaz $(5)$}}\ \ Plyne z $(1)$ a $T\models \varphi \to \psi\ \Leftrightarrow M(T,\varphi) \subseteq M(T,\psi) \subseteq M(\psi) \Leftrightarrow T,\varphi \models \psi$.

{\it \myblue{Poznámka}}\ \ Větu o dedukci lze dokázat přímo, transformací příslušných tabel.
% :from slides

\subsection{Löwenheim-Skolemova věta}\todo

% from slides:
{\bf \myblue{Věta}}\ \ {\it Každá bezesporná teorie $T$ spočetného jazyka $L$ bez rovnosti má
\smallskip

\myblue{spočetně nekonečný} model.}
\medskip

{\it \myblue{Důkaz}}\ \ Nechť $\tau$ je systematické tablo z $T$ s $F\bot$ v kořeni. Jelikož je dokončené
\smallskip

 a obsahuje bezespornou větev $V$, neboť $\bot$ není dokazatelný z $T$, existuje
\smallskip

\myblue{kanonický model} $\mathcal{A}$ z $V$. Jelikož se $\mathcal{A}$ shoduje s $V$, jeho redukt na jazyk $L$
\smallskip

je hledaným spočetně nekonečným modelem $T$. $\qed$
\medskip

{\it \myblue{Poznámka}\ \ Jde o slabou verzi tzv. \myblue{Löwenheim-Skolemovy věty}. Ve
\smallskip

spočetném jazyce s rovností je kanonický model s rovností \myblue{spočetný}.}
\bigskip

{\bf \myblue{Věta}}\ \ {\it Teorie má model, právě když každá její \myblue{konečná} část má model.}
\medskip

{\it \myblue{Důkaz}}\ \ Implikace zleva doprava je zřejmá. Pokud teorie $T$ nemá model,
\smallskip

je sporná, tj. je z ní dokazatelný $\bot$ systematickým tablem $\tau$. Jelikož je  $\tau$
\smallskip

konečné, je $\bot$ dokazatelný z nějaké konečné $T'\subseteq T$, tj. $T'$ nemá model. $\qed$
% :from slides

\subsection{Věta o kompaktnosti}\todo


\subsection{Aplikace}\todo

% from slides:

\subsubsection*{Nestandardní model přirozených čísel}
    
    Nechť \mygreen{$\underline{\mathbb{N}}=\langle\mathbb{N},S,+,\cdot,0,\le\rangle$} je standardní model přirozených čísel.
    \bigskip
    
    Označme \mdef{$\mathrm{Th}(\underline{\mathbb{N}})$} množinu všech pravdivých \myblue{sentencí} v $\underline{\mathbb{N}}$. Pro $n\in \mathbb{N}$ označme
    \smallskip
    
    \mdef{$\underline{n}$} term \mygreen{$S(S(\cdots (S(0)\cdots)$}, tzv. \mdef{$n$-tý numerál}, kde $S$ je aplikováno $n$-krát.
    \bigskip
    
    Uvažme následující teorii $T$, kde $c$ je nový konstantní symbol.
    \vspace{-2mm}
    \mygreen{$$T=\mathrm{Th}(\underline{\mathbb{N}})\cup\{\underline{n}<c\mid n\in \mathbb{N}\}$$}
    
    \vspace{-4mm}
    {\it \myblue{Pozorování}\ \ Každá konečná část teorie $T$ má model.}
    \bigskip
    
    {\it Tedy dle věty o kompaktnosti má $T$ model $\mathcal{A}$, jde o \mdef{nestandardní model}
    \smallskip
    
    \mdef{přirozených čísel}. Každá sentence z $\mathrm{Th}(\underline{\mathbb{N}})$ v něm platí, ale zároveň obsahuje
    \smallskip
    
    prvek $c^A$ větší než každé $n\in \mathbb{N}$ (tj. hodnota termu $\underline{n}$ v $\mathcal{A}$).}
    

% :from slides


\section{(draft) Hilbertovský kalkulus v predikátové logice}\todo

% from slides:
\subsubsection*{Hilbertovský kalkul}
    \begin{itemize}
    \item základní logické spojky a kvantifikátory:\ \ $\neg$, $\to$, $(\forall x)$ (ostatní odvozené)
    
    \item dokazují se libovolné formule (nejen sentence)
    
    \item \mdef{logické axiomy} (\myblue{schémata} logických axiomů)
    \vspace{-2mm}\begin{align*}(i)& &\varphi &\to (\psi \to \varphi) \\
    (ii)& &(\varphi\to (\psi \to \chi))&\to ((\varphi \to \psi)\to(\varphi \to \chi))\qquad\qquad\qquad\qquad\phantom{\ } \\
    (iii)& &(\neg \varphi \to \neg \psi)&\to(\psi \to \varphi)\\
    (iv)& &(\forall x)\varphi &\to\varphi(x/t)\quad\quad\quad\ \ \!\text{ je-li $t$ substituovatelný za $x$ do $\varphi$}\\
    (v)& &(\forall x)(\varphi \to \psi)&\to(\varphi \to (\forall x)\psi)\quad\text{není-li $x$ volná proměnná ve $\varphi$}\\
    \end{align*}
    
    \vspace{-6mm}
    kde $\varphi$, $\psi$, $\chi$ jsou libovolné formule (daného jazyka), $t$ je libovolný term a
    \vspace{0.5mm}
    
    $x$ je libovolná proměnná.
    \smallskip
    
    \item je-li jazyk s rovností, mezi logické axiomy patří navíc \myblue{axiomy rovnosti}
    
    \item \mdef{odvozovací (deduktivní) pravidla}
    \vspace{-2mm}
    $$\frac{\varphi,\ \varphi \to \psi}{\psi}\quad\text{\myblue{(modus ponens)},}\qquad\frac{\varphi}{(\forall x)\varphi}\quad\text{\myblue{(generalizace)}}$$
    \end{itemize}
    
    
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
    \subsubsection*{Pojem důkazu}
    \mdef{Důkaz} (\emph{Hilbertova stylu}) formule $\varphi$ z teorie $T$ je \myblue{konečná} posloupnost
    \smallskip
    
    $\varphi_0, \dots, \varphi_n=\varphi$ formulí taková, že pro každé $i\le n$
    \smallskip
    
    \begin{itemize}
    \item $\varphi_i$ je logický axiom nebo $\varphi_i \in T$ (axiom teorie), nebo
    \smallskip
    
    \item $\varphi_i$ lze odvodit z předchozích formulí pomocí odvozovacích pravidel.
    \end{itemize}
    \smallskip
    
    Formule $\varphi$ je \mdef{dokazatelná} v $T$, má-li důkaz z $T$, značíme $T \vdash_{H} \varphi$.
    \bigskip
    
    {\bf \myblue{Věta}}\ \ {\it  Pro každou teorii $T$ a formuli $\varphi$,\ \ $T\vdash_H \varphi\ \Rightarrow\ T\models \varphi$.}
    \medskip
    
    {\it \myblue{Důkaz}}
    \begin{itemize}
    \item Je-li $\varphi\in T$ nebo logický axiom, je $T \models \varphi$ (logické axiomy jsou tautologie),
    \item jestliže $T \models \varphi$ a $T \models \varphi \to \psi$, pak $T \models \psi$, \emph{tj. modus ponens je korektní},
    \item jestliže $T \models \varphi$, pak $T \models (\forall x)\varphi$, \emph{tj. pravidlo generalizace je korektní},
    \item tedy každá formule vyskytující se v důkazu z $T$ platí v $T$. $\qed$
    \end{itemize}
    \medskip
    
    {\it \myblue{Poznámka}\ \ Platí i \myblue{úplnost}, tj. $T\models \varphi \Rightarrow T\vdash_H \varphi$ pro každou teorii $T$ a formuli $\varphi$.}
% :from slides